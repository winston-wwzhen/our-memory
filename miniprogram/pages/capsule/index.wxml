<view class="capsule-container">
  
  <view class="tab-header">
    <view class="tab-item {{currentTab===0?'active':''}}" bindtap="switchTab" data-idx="0">æˆ‘æ”¶åˆ°çš„</view>
    <view class="tab-item {{currentTab===1?'active':''}}" bindtap="switchTab" data-idx="1">æˆ‘åŸ‹ä¸‹çš„</view>
  </view>

  <scroll-view scroll-y class="list-scroll">
    <view class="list-content">
      
      <view class="empty-state" wx:if="{{currentTab === 0 ? inboxList.length === 0 : sentList.length === 0}}">
        <text class="empty-icon">ğŸƒ</text>
        <text wx:if="{{currentTab===0}}">è¿˜æ²¡æœ‰æ”¶åˆ° TA çš„èƒ¶å›Š\nå¿«å»æé†’ TA åŸ‹ä¸€ä¸ªå§~</text>
        <text wx:else>è¿˜æ²¡åŸ‹ä¸‹è¿‡èƒ¶å›Š\nç»™æœªæ¥çš„ TA å†™å°ä¿¡å§~</text>
      </view>

      <block wx:for="{{currentTab===0 ? inboxList : sentList}}" wx:key="_id">
        <view 
          class="capsule-card {{item.isOpened ? 'opened' : ''}}" 
          bindtap="onCapsuleTap" 
          data-item="{{item}}"
        >
          <view class="card-left">
            <view class="status-icon-box">
              <text wx:if="{{item.isLocked}}">ğŸ”’</text>
              <text wx:elif="{{item.canOpen}}">ğŸ</text>
              <text wx:else>ğŸ“‚</text>
            </view>
            <view class="line-connect"></view>
          </view>

          <view class="card-right">
            <view class="card-date-label">å¼€å¯æ—¥æœŸ: {{item.openDate}}</view>
            <view class="card-title" wx:if="{{item.isLocked}}">å°å°ä¸­çš„èƒ¶å›Š</view>
            <view class="card-title highlight" wx:elif="{{item.canOpen}}">æ—¶é—´å·²åˆ°ï¼Œç‚¹å‡»å¼€å¯ï¼</view>
            <view class="card-title normal" wx:else>ç¾å¥½çš„å›å¿†</view>
            <view class="card-desc" wx:if="{{item.isLocked}}">æ¥è‡ª {{item.createDate}} çš„å¯„è¯­</view>
            <view class="card-desc" wx:else>{{item.content ? 'åŒ…å«æ–‡å­—ä¿¡ä»¶' : ''}} {{item.imageFileID ? '+ çè´µç…§ç‰‡' : ''}}</view>
          </view>

          <view class="status-tag" wx:if="{{currentTab===1}}">
            {{item.status === 1 ? 'TAå·²è¯»' : 'æœªå¼€å¯'}}
          </view>
        </view>
      </block>

    </view>
    <view style="height: 150rpx;"></view>
  </scroll-view>

  <view class="fab-area">
    <view class="limit-tip" wx:if="{{currentTab===1}}">
        å‰©ä½™å®¹é‡: {{limit - usage}}/{{limit}}
    </view>
    <view class="fab-btn" bindtap="navToCreate">
        <text>ğŸ’Š åŸ‹èƒ¶å›Š</text>
    </view>
  </view>

  <view class="modal-mask" wx:if="{{showModal}}" bindtap="closeModal">
    <view class="modal-box" catchtap="true">
      <block wx:if="{{modalType === 'locked'}}">
        <view class="modal-icon">â³</view>
        <view class="modal-title">å°å°ä¸­</view>
        <view class="modal-desc">è¿™é¢—èƒ¶å›Šè¿˜éœ€è¦ç­‰å¾…</view>
        <view class="countdown-num">{{countdownStr}}</view>
        <view class="modal-desc">æ‰èƒ½å¼€å¯å“¦</view>
        <button class="btn-close" bindtap="closeModal">æˆ‘çŸ¥é“äº†</button>
      </block>
      <block wx:if="{{modalType === 'open_confirm'}}">
        <view class="modal-icon bounce">ğŸ</view>
        <view class="modal-title">æ—¶é—´åˆ°äº†ï¼</view>
        <view class="modal-desc">è¿™æ˜¯ TA åœ¨ {{selectedCapsule.createDate}} ä¸ºä½ åŸ‹ä¸‹çš„æƒŠå–œã€‚</view>
        <button class="btn-open" bindtap="doOpenCapsule">ç«‹å³å¼€å¯</button>
      </block>
      <block wx:if="{{modalType === 'content'}}">
        <view class="content-scroll">
          <view class="letter-paper">
            <view class="letter-header">To: æœªæ¥çš„ä½ </view>
            <text class="letter-body">{{selectedCapsule.content}}</text>
            <image wx:if="{{selectedCapsule.imageFileID}}" src="{{selectedCapsule.imageFileID}}" mode="widthFix" class="letter-img" bindtap="previewImg"></image>
            <view class="letter-footer">From: {{selectedCapsule.createDate}}</view>
          </view>
        </view>
        <view class="close-bar" bindtap="closeModal">âœ•</view>
      </block>
    </view>
  </view>

  <view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
    <view class="god-rays"></view>
    <view class="confetti-container">
      <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
      <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
      <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
      <view class="confetti c10"></view>
    </view>
    <view class="egg-card bounce-in">
      <view class="card-ribbon">LUCKY TIME</view>
      <view class="icon-stage">
        <view class="halo-ring"></view>
        <text class="egg-icon">{{eggData.icon}}</text>
        <view class="shine-star s-left">âœ¨</view>
        <view class="shine-star s-right">âœ¨</view>
      </view>
      <view class="egg-title">{{eggData.title}}</view>
      <view class="egg-desc">{{eggData.desc}}</view>
      <view class="egg-reward-box">
        <text class="reward-label">è·å¾—å¥–åŠ±</text>
        <view class="reward-val-row">
          <text class="val-num">+{{eggData.bonus}}</text>
          <text class="val-unit">g çˆ±æ„ ğŸ’§</text>
        </view>
      </view>
      <button class="btn-get-egg" bindtap="closeEggModal">
        <text>å¼€å¿ƒæ”¶ä¸‹ â¤ï¸</text>
      </button>
    </view>
  </view>

</view>