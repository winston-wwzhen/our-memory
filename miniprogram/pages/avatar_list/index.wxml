<wxs module="imgUtils">
  var getThumb = function(url) {
    if (!url) return '/images/default-avatar.png';
    // å…¼å®¹ cloud:// å’Œæ™®é€šé“¾æ¥
    if (url.indexOf('cloud://') === 0) return url;
    if (url.indexOf('imageMogr2') > -1) return url;
    var joinChar = url.indexOf('?') > -1 ? '&' : '?';
    // åˆ—è¡¨é¡µä½¿ç”¨è¾ƒå°çš„ç¼©ç•¥å›¾
    return url + joinChar + 'imageMogr2/thumbnail/340x/quality/80/format/webp'; 
  }
  module.exports.getThumb = getThumb;
</wxs>

<view class="container">
  
  <view class="bg-decoration">
    <view class="floating-heart h1">â¤</view>
    <view class="floating-heart h2">â¤</view>
    <view class="floating-heart h3">â¤</view>
    <view class="floating-heart h4">â¤</view>
    <view class="floating-heart h5">â¤</view>
  </view>

  <view class="content-wrapper">
    
    <view class="banner-box glass-effect">
      <view class="banner-text">
        <text class="title">ç”œèœœå¤´åƒé¦†</text>
        <text class="subtitle">æ¢ä¸Šä¸€å¯¹å¤´åƒï¼Œå®£ç¤ºä¸»æƒå§ ğŸ’•</text>
      </view>
      <view class="make-btn" bindtap="onMakeAvatar" hover-class="btn-hover">
        <view class="btn-content">
          <text class="btn-icon">ğŸ¨</text>
          <text class="btn-txt">å®šåˆ¶</text>
        </view>
      </view>
    </view>

    <view class="avatar-grid">
      <block wx:for="{{list}}" wx:key="_id">
        <view class="card" bindtap="navToDetail" data-id="{{item._id}}" hover-class="card-hover">
          
          <view class="image-box">
            <image 
              class="cover-img" 
              src="{{imgUtils.getThumb(item.cover_url)}}" 
              mode="aspectFill" 
              lazy-load="{{true}}"
            ></image>
            
            <view class="split-line"></view>

            <view class="heart-connector">
              <view class="heart-icon">â¤</view>
            </view>

            <view class="tag vip" wx:if="{{item.is_vip}}">VIP</view>
            <view class="tag hot" wx:elif="{{item.downloads > 500}}">ğŸ”¥ HOT</view>
          </view>

          <view class="info-box">
            <view class="card-title">{{item.title}}</view>
            <view class="card-meta">
              <text class="category">#{{item.category || 'ç²¾é€‰'}}</text>
              <text class="count">{{item.downloads}}äººå–œæ¬¢</text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <view class="footer-state">
      <view class="loading-wrap" wx:if="{{loading}}">
        <view class="dot"></view><view class="dot"></view><view class="dot"></view>
      </view>
      <view class="no-more" wx:if="{{!hasMore && !loading}}">- åˆ°åº•å•¦ï¼Œå¿«å»æ¢å¤´åƒå§ -</view>
    </view>
  </view>
</view>