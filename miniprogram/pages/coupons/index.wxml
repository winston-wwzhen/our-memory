<view class="coupon-container">
  
  <view class="header-balance">
    <text class="balance-label">å¯ç”¨ç«ç‘°</text>
    <view class="balance-val">
      <text class="num">{{roseBalance}}</text>
      <text class="icon">ğŸŒ¹</text>
    </view>
  </view>

  <view class="tab-header">
    <view class="tab-item {{currentTab===0?'active':''}}" bindtap="switchTab" data-idx="{{0}}">ç‰¹æƒå·¥åŠ</view>
    <view class="tab-item {{currentTab===1?'active':''}}" bindtap="switchTab" data-idx="{{1}}">æˆ‘çš„å¡ç‰‡</view>
  </view>

  <view class="shop-view" wx:if="{{currentTab===0}}">
    <view class="coupon-grid">
      <block wx:for="{{templates}}" wx:key="id">
        <view class="shop-item paper-texture" bindtap="onRedeem" data-item="{{item}}">
          <view class="item-top" style="background: {{item.color}}20;"> 
            <text class="item-title">{{item.title}}</text>
            <text class="item-cost">{{item.cost}} ğŸŒ¹</text>
          </view>
          <view class="item-body">
            <text class="item-desc">{{item.desc}}</text>
            <button class="btn-buy">åˆ¶ä½œ</button>
          </view>
        </view>
      </block>
    </view>
  </view>

  <view class="wallet-view" wx:if="{{currentTab===1}}">
    <view class="empty-state" wx:if="{{myCoupons.length === 0}}">
      <text>å¡åŒ…ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«å»åˆ¶ä½œå§~</text>
    </view>

    <block wx:for="{{myCoupons}}" wx:key="_id">
      <view class="ticket-card {{item.status > 0 ? 'used' : ''}}">
        <view class="ticket-main" style="border-left: 10rpx solid {{item.status>0 ? '#ccc' : '#ff6b81'}};">
          <view class="ticket-info">
            <text class="t-title">{{item.title}}</text>
            <text class="t-time">  åˆ¶ä½œäº {{item.createTimeStr}}</text>
          </view>
          <view class="ticket-status">
            <text wx:if="{{item.status===0}}" class="status-tag">æœªä½¿ç”¨</text>
            <text wx:if="{{item.status===1}}" class="status-tag process">æ ¸é”€ä¸­</text>
            <text wx:if="{{item.status===2}}" class="status-tag done">å·²ä½¿ç”¨</text>
          </view>
        </view>
        <view class="ticket-rip"></view>
        <view class="ticket-stub" bindtap="{{item.isRequest ? 'onVerifyCoupon' : 'onUseCoupon'}}" 
              data-id="{{item._id}}" 
              data-status="{{item.status}}"
              style="{{item.isRequest ? 'background:#e3f2fd;color:#1976d2;' : ''}}">
          
          <block wx:if="{{!item.isRequest}}">
            <text wx:if="{{item.status===0}}">ç‚¹å‡»\nä½¿ç”¨</text>
            <text wx:elif="{{item.status===1}}">ç­‰å¾…\nç¡®è®¤</text>
            <text wx:else>ç¥¨æ ¹\nç•™å¿µ</text>
          </block>

          <block wx:else>
            <text style="font-size:22rpx">TAç”³è¯·\nä½¿ç”¨</text>
            <text style="font-size:32rpx;margin-top:4rpx">âœ…</text>
          </block>
        </view>
      </view>
    </block>
  </view>

  <view class="custom-modal-mask {{showModal ? 'show' : ''}}" bindtap="closeModal">
    <view class="custom-modal-content" catchtap="true"> <view class="modal-header">âœ¨ åˆ¶ä½œç¡®è®¤</view>
      <view class="modal-body">
        <view class="modal-line">
          å³å°†æ¶ˆè€— <text class="highlight-cost">{{selectedItem.cost}}</text> æœµç«ç‘° ğŸŒ¹
        </view>
        <view class="modal-line-sub">ç”¨äºåˆ¶ä½œä¸€å¼ </view>
        <view class="modal-card-name">
          ã€Œ {{selectedItem.title}} ã€
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn-modal-cancel" bindtap="closeModal">å†æƒ³æƒ³</button>
        <button class="btn-modal-confirm" bindtap="confirmRedeem">ç¡®å®šåˆ¶ä½œ</button>
      </view>
    </view>
  </view>

  <view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
  <view class="god-rays"></view>
  <view class="confetti-container">
    <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
    <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
    <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
    <view class="confetti c10"></view>
  </view>
  <view class="egg-card bounce-in">
    <view class="card-ribbon">LUCKY TIME</view>
    <view class="icon-stage">
      <view class="halo-ring"></view>
      <text class="egg-icon">{{eggData.icon}}</text>
      <view class="shine-star s-left">âœ¨</view>
      <view class="shine-star s-right">âœ¨</view>
    </view>
    <view class="egg-title">{{eggData.title}}</view>
    <view class="egg-desc">{{eggData.desc}}</view>
    <view class="egg-reward-box">
      <text class="reward-label">è·å¾—å¥–åŠ±</text>
      <view class="reward-val-row">
        <text class="val-num">+{{eggData.bonus}}</text>
        <text class="val-unit">g çˆ±æ„ ğŸ’§</text>
      </view>
    </view>
    <button class="btn-get-egg" bindtap="closeEggModal">
      <text>å¼€å¿ƒæ”¶ä¸‹ â¤ï¸</text>
    </button>
  </view>
</view>

</view>