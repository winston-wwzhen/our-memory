<view class="decision-container">
  
  <view class="bg-decoration">
    <view class="glow-blob b1"></view>
    <view class="glow-blob b2"></view>
    <view class="sparkle s1">âœ¦</view>
    <view class="sparkle s2">âœ¦</view>
    <view class="sparkle s3">âœ¦</view>
  </view>

  <view class="bubble-stage">
    <view class="partner-cloud slide-down" wx:if="{{partnerDecision}}">
      <image class="p-avatar" src="../../images/default-avatar.png"></image>
      <text>TA é€‰äº†ï¼š{{partnerDecision.result}}</text>
    </view>

    <view class="bubble-container">
      <view class="bubble-item {{currentTab===index?'active':''}}" 
            wx:for="{{themes}}" wx:key="id" 
            bindtap="switchTab" data-index="{{index}}">
        <view class="bubble-glass">
          <text class="bubble-text">{{item.title}}</text>
          <view class="bubble-highlight"></view>
        </view>
      </view>
    </view>
  </view>

  <view class="card-stage">
    
    <view class="result-modal {{showResult ? 'visible' : ''}}">
      <view class="modal-mask"></view>
      
      <view class="god-rays"></view>
      
      <view class="confetti-container">
        <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
        <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
        <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
        <view class="confetti c10"></view>
      </view>

      <view class="modal-card bounce-in">
        <view class="ribbon-top">âœ¨ å‘½è¿çš„æŒ‡å¼• âœ¨</view>
        
        <view class="result-content">
          <text class="result-emoji">ğŸ”®</text>
          <view class="result-label">å†³å®šå°±æ˜¯</view>
          <text class="result-val">{{finalResult}}</text>
        </view>

        <view class="btn-group">
          <button class="btn-secondary" bindtap="resetGame">å†è¯•ä¸€æ¬¡ ğŸ”„</button>
          <button class="btn-primary" open-type="share">å‘Šè¯‰ TA ğŸ“¢</button>
        </view>
      </view>
    </view>

    <view class="cards-fan {{showResult ? 'blur-out' : ''}}">
      <block wx:for="{{cards}}" wx:key="id">
        <view class="card-wrapper {{isShuffling ? 'shuffling' : ''}} {{item.flipped ? 'flipped' : ''}}"
              style="--rot: {{item.rotate}}deg; --idx: {{index}};"
              bindtap="flipCard" data-index="{{index}}">
          
          <view class="card-body">
            <view class="flash-layer"></view> 

            <view class="card-back">
              <view class="card-design">
                <text class="corner tl">âœ¦</text>
                <text class="corner tr">âœ¦</text>
                <text class="corner bl">âœ¦</text>
                <text class="corner br">âœ¦</text>
                <view class="center-symbol">
                  <text class="symbol-icon">â¤</text>
                </view>
                <text class="card-hint">Fate</text>
              </view>
            </view>

            <view class="card-face">
              <view class="face-frame">
                <text class="face-icon top">âœ¨</text>
                <text class="face-text">{{item.value}}</text>
                <text class="face-icon bottom">âœ¨</text>
                <view class="face-bg-pattern"></view>
              </view>
            </view>
          </view>

        </view>
      </block>
    </view>

    <view class="footer-hint" wx:if="{{!showResult && !isShuffling}}">
      <text>ç›¸ä¿¡ç›´è§‰ï¼Œç‚¹å‡»ä¸€å¼ å¡ç‰Œ</text>
    </view>

  </view>
</view>