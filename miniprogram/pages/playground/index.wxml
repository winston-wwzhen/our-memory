<view class="playground-container">

<view class="room-container">
  
  <view class="ground-spot"></view>

  <view wx:if="{{petState === 'idle'}}" class="pet-container">
    <image src="/images/pet/pet.png"
           class="pet-character {{petAnimation}}"
           bindtap="onPetTap"></image>
  </view>

  <view wx:elif="{{petState === 'eating'}}" class="pet-container">
    <image src="/images/pet/eat.png"
           class="pet-character eating-animation"></image>
  </view>

  <view wx:elif="{{petState === 'traveling'}}" class="travel-note-container">
    <image src="/images/pet/note.png" class="travel-note"></image>
    <text class="note-text">{{petName}}å»æ—…è¡Œå•¦~</text>
    <text class="return-time">é¢„è®¡{{returnTimeStr}}è¿”å›</text>
  </view>

  <view class="ui-overlay">
    <view class="status-pill pet-info">
      <text class="pill-icon">ğŸ¾</text>
      <text class="pill-text">{{petName}}</text>
      <view class="v-divider"></view>
      <view class="status-group">
        <view class="status-item">
          <text class="status-emoji">{{moodValue < 60 ? 'ğŸ˜”' : 'ğŸ˜Š'}}</text>
          <text class="status-info">
            <text class="pill-label">å¿ƒæƒ…</text>
            <text class="pill-value {{moodValue < 60 ? 'low' : ''}}">{{moodText}}</text>
          </text>
        </view>
        <view class="status-item">
          <text class="status-emoji">{{energyLevel < 30 ? 'ğŸ˜´' : 'ğŸ’ª'}}</text>
          <text class="status-info">
            <text class="pill-label">ä½“åŠ›</text>
            <text class="pill-value {{energyLevel < 30 ? 'low' : ''}}">{{energyText}}</text>
          </text>
        </view>
      </view>
    </view>

    <view class="status-pill resource-info">
      <text class="pill-icon">ğŸ’§</text>
      <text class="pill-value">{{loveEnergy}}g</text>
    </view>

    <view class="action-buttons">
      <view class="action-btn-glass" bindtap="onTravelMap">
        <view class="glass-icon-box blue"><text>ğŸ—ºï¸</text></view>
        <text class="glass-label">åœ°å›¾</text>
      </view>

      <view class="action-btn-glass" bindtap="onPostcards">
        <view class="glass-icon-box orange">
          <text>ğŸ’Œ</text>
          <view wx:if="{{hasNewPostcards}}" class="notification-dot"></view>
        </view>
        <text class="glass-label">ä¿¡ç®±</text>
      </view>

      <view class="action-btn-glass {{petState !== 'idle' ? 'disabled' : ''}}"
            bindtap="onBackpackTap">
        <view class="glass-icon-box green"><text>ğŸ’</text></view>
        <text class="glass-label">è¡Œå›Š</text>
      </view>
    </view>
  </view>

  <view wx:if="{{statusMessage}}" class="status-toast"><text>{{statusMessage}}</text></view>
  <view wx:for="{{heartParticles}}" wx:key="id" class="heart-particle" style="left: {{item.left}}%; bottom: 20%;">â¤ï¸</view>
</view>

<view class="section-divider">
  <view class="divider-line left"></view>
  <view class="divider-content">
    <text class="divider-icon">ğŸŒ¹</text>
    <text class="divider-text">GARDEN TIME</text>
    <text class="divider-icon">ğŸŒ¹</text>
  </view>
  <view class="divider-line right"></view>
</view>

<view class="menu-section">
  <view class="grid-menu">
    <view class="grid-card" bindtap="navToQuiz">
      <view class="card-icon-bg purple"><text class="card-icon">ğŸ§©</text></view>
      <view class="card-info">
        <text class="card-title">é»˜å¥‘é—¯å…³</text>
        <text class="card-desc">çµé­‚å¥‘åˆåº¦</text>
      </view>
      <view class="tag-badge quiz" wx:if="{{quizHint}}">å¾…æŒ‘æˆ˜</view>
    </view>

    <view class="grid-card" bindtap="navToBoard">
      <view class="card-icon-bg pink"><text class="card-icon">ğŸ“Œ</text></view>
      <view class="card-info">
        <text class="card-title">ç•™è¨€æ¿</text>
        <text class="card-desc">æ—¥å¸¸ç¢ç¢å¿µ</text>
      </view>
      <view class="tag-badge new" wx:if="{{messageHint}}">æ–°ç•™è¨€</view>
    </view>

    <view class="grid-card" bindtap="navToCapsule">
      <view class="card-icon-bg blue"><text class="card-icon">ğŸ’Š</text></view>
      <view class="card-info">
        <text class="card-title">æ—¶å…‰èƒ¶å›Š</text>
        <text class="card-desc">å¯„ç»™æœªæ¥</text>
      </view>
      <view class="tag-badge love" wx:if="{{capsuleRedDot}}">â¤</view>
    </view>

    <view class="grid-card" bindtap="navToDecision">
      <view class="card-icon-bg yellow"><text class="card-icon">ğŸ²</text></view>
      <view class="card-info">
        <text class="card-title">å†³å®šè½¬ç›˜</text>
        <text class="card-desc">æ²»æ„ˆé€‰æ‹©å›°éš¾</text>
      </view>
    </view>

    <view class="grid-card" bindtap="navToCoupons">
      <view class="card-icon-bg red"><text class="card-icon">ğŸŸï¸</text></view>
      <view class="card-info">
        <text class="card-title">ç‰¹æƒå·¥åŠ</text>
        <text class="card-desc">å…‘æ¢ä¸“å±æƒç›Š</text>
      </view>
    </view>

    <view class="grid-card" bindtap="navToGuide">
      <view class="card-icon-bg cyan"><text class="card-icon">ğŸ“’</text></view>
      <view class="card-info">
        <text class="card-title">æ‹çˆ±å®å…¸</text>
        <text class="card-desc">é€šå…³ç§˜ç±</text>
      </view>
    </view>
  </view>
</view>

<view class="log-modal-mask {{showLogModal ? 'show' : ''}}" bindtap="toggleLogModal">
  <view class="log-modal-container" catchtap="return">
    <view class="log-modal-header">
      <text>ğŸ“œ äº’åŠ¨æ—¥è®°</text>
      <view class="close-icon" bindtap="toggleLogModal">Ã—</view>
    </view>
    <scroll-view scroll-y class="log-scroll-view">
      <view class="empty-log" wx:if="{{logs.length === 0}}">
        <text>æš‚æ— è®°å½•ï¼Œå¿«å’Œå® ç‰©äº’åŠ¨å§~</text>
      </view>
      <block wx:else>
        <view class="modal-log-item" wx:for="{{logs}}" wx:key="index">
          <image class="modal-log-avatar" src="{{item.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="modal-log-content">
            <view class="modal-log-top">
              <text class="modal-log-name {{item.isMine ? 'mine' : 'partner'}}">{{item.nickName}}</text>
              <text class="modal-log-time">{{item.timeAgo}}</text>
            </view>
            <text class="modal-log-desc">{{item.content}}</text>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>
</view>

<view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
  <view class="god-rays"></view>
  <view class="confetti-container">
     <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
     <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
     <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
     <view class="confetti c10"></view>
  </view>
  <view class="egg-card bounce-in">
    <view class="card-ribbon">LUCKY TIME</view>
    <view class="icon-stage">
      <view class="halo-ring"></view>
      <text class="egg-icon">{{eggData.icon}}</text>
      <view class="shine-star s-left">âœ¨</view>
      <view class="shine-star s-right">âœ¨</view>
    </view>
    <view class="egg-title">{{eggData.title}}</view>
    <view class="egg-desc">{{eggData.desc}}</view>
    
    <view class="egg-reward-box">
      <text class="reward-label">è·å¾—å¥–åŠ±</text>
      <view class="reward-val-row">
        <text class="val-num">+{{eggData.bonus}}</text>
        <text class="val-unit">g çˆ±æ„ ğŸ’§</text>
      </view>
    </view>
    <button class="btn-get-egg" bindtap="closeEggModal">
      <text>å¼€å¿ƒæ”¶ä¸‹ â¤ï¸</text>
    </button>
  </view>
</view>
<food-prep-modal show="{{showFoodPrepModal}}" loveEnergy="{{loveEnergy}}" foodInventory="{{foodInventory}}" bind:cancel="onFoodPrepModalCancel" bind:prepare="onFoodPrepare" bind:success="onFoodPrepSuccess"></food-prep-modal>

</view>