<view class="playground-container">

  <view class="room-container">
    
    <view wx:if="{{petState === 'idle'}}" class="pet-container">
      <image src="/images/pet/pet.png"
             class="pet-character {{petAnimation}}"
             bindtap="onPetTap"></image>
    </view>

    <view wx:elif="{{petState === 'eating'}}" class="pet-container">
      <image src="/images/pet/eat.png"
             class="pet-character eating-animation"></image>
    </view>

    <view wx:elif="{{petState === 'traveling'}}" class="travel-note-container">
      <image src="/images/pet/note.png" class="travel-note"></image>
      <text class="note-text">{{petName}}去旅行啦~</text>
      <text class="return-time">预计{{returnTimeStr}}返回</text>
    </view>

    <view class="ui-overlay">
      <view class="status-pill pet-info">
        <text class="pill-icon">🐾</text>
        <text class="pill-text">{{petName}}</text>
        <view class="v-divider"></view>
        <text class="pill-label">心情</text>
        <text class="pill-value {{moodValue < 60 ? 'low' : ''}}">{{moodValue}}</text>
      </view>

      <view class="status-pill resource-info">
        <text class="pill-icon">💧</text>
        <text class="pill-value">{{loveEnergy}}g</text>
      </view>

      <view class="action-buttons">
        
        <view class="action-btn-glass" bindtap="onTravelMap">
          <view class="glass-icon-box blue">
            <text>🗺️</text>
          </view>
          <text class="glass-label">地图</text>
        </view>

        <view class="action-btn-glass" bindtap="onPostcards">
          <view class="glass-icon-box orange">
            <text>💌</text>
            <view wx:if="{{hasNewPostcards}}" class="notification-dot"></view>
          </view>
          <text class="glass-label">信箱</text>
        </view>

        <view class="action-btn-glass {{petState !== 'idle' ? 'disabled' : ''}}"
              bindtap="onBackpackTap">
          <view class="glass-icon-box green">
            <text>🎒</text>
          </view>
          <text class="glass-label">行囊</text>
        </view>

      </view>
    </view>

    <view wx:if="{{statusMessage}}" class="status-toast">
      <text>{{statusMessage}}</text>
    </view>

    <view wx:for="{{heartParticles}}" wx:key="id"
          class="heart-particle"
          style="left: {{item.left}}%; bottom: 20%;">
      ❤️
    </view>
  </view>

  <view class="menu-section">
    <view class="section-title">✨ 甜蜜互动</view>
    <view class="grid-menu">
      
      <view class="grid-card" bindtap="navToQuiz">
        <view class="card-icon-bg purple">
          <text class="card-icon">🧩</text>
        </view>
        <view class="card-info">
          <text class="card-title">默契闯关</text>
          <text class="card-desc">灵魂契合度</text>
        </view>
        <view class="tag-badge quiz" wx:if="{{quizHint}}">待挑战</view>
      </view>

      <view class="grid-card" bindtap="navToBoard">
        <view class="card-icon-bg pink">
          <text class="card-icon">📌</text>
        </view>
        <view class="card-info">
          <text class="card-title">留言板</text>
          <text class="card-desc">日常碎碎念</text>
        </view>
        <view class="tag-badge new" wx:if="{{messageHint}}">新留言</view>
      </view>

      <view class="grid-card" bindtap="navToCapsule">
        <view class="card-icon-bg blue">
          <text class="card-icon">💊</text>
        </view>
        <view class="card-info">
          <text class="card-title">时光胶囊</text>
          <text class="card-desc">寄给未来</text>
        </view>
        <view class="tag-badge love" wx:if="{{capsuleRedDot}}">❤</view>
      </view>

      <view class="grid-card" bindtap="navToDecision">
        <view class="card-icon-bg yellow">
          <text class="card-icon">🎲</text>
        </view>
        <view class="card-info">
          <text class="card-title">决定转盘</text>
          <text class="card-desc">治愈选择困难</text>
        </view>
      </view>

      <view class="grid-card" bindtap="navToCoupons">
        <view class="card-icon-bg red">
          <text class="card-icon">🎟️</text>
        </view>
        <view class="card-info">
          <text class="card-title">特权工坊</text>
          <text class="card-desc">兑换专属权益</text>
        </view>
      </view>

      <view class="grid-card" bindtap="navToGuide">
        <view class="card-icon-bg cyan">
          <text class="card-icon">📒</text>
        </view>
        <view class="card-info">
          <text class="card-title">恋爱宝典</text>
          <text class="card-desc">通关秘籍</text>
        </view>
      </view>

    </view>
  </view>

  <view class="log-modal-mask {{showLogModal ? 'show' : ''}}" bindtap="toggleLogModal">
    <view class="log-modal-container" catchtap="return">
      <view class="log-modal-header">
        <text>📜 互动日记</text>
        <view class="close-icon" bindtap="toggleLogModal">×</view>
      </view>
      <scroll-view scroll-y class="log-scroll-view">
        <view class="empty-log" wx:if="{{logs.length === 0}}">
          <text>暂无记录，快和宠物互动吧~</text>
        </view>
        <block wx:else>
          <view class="modal-log-item" wx:for="{{logs}}" wx:key="index">
            <image class="modal-log-avatar" src="{{item.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
            <view class="modal-log-content">
              <view class="modal-log-top">
                <text class="modal-log-name {{item.isMine ? 'mine' : 'partner'}}">{{item.nickName}}</text>
                <text class="modal-log-time">{{item.timeAgo}}</text>
              </view>
              <text class="modal-log-desc">{{item.content}}</text>
            </view>
          </view>
        </block>
      </scroll-view>
    </view>
  </view>

  <view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
    <view class="god-rays"></view>
    <view class="confetti-container">
       <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
       <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
       <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
       <view class="confetti c10"></view>
    </view>
    <view class="egg-card bounce-in">
      <view class="card-ribbon">LUCKY TIME</view>
      <view class="icon-stage">
        <view class="halo-ring"></view>
        <text class="egg-icon">{{eggData.icon}}</text>
        <view class="shine-star s-left">✨</view>
        <view class="shine-star s-right">✨</view>
      </view>
      <view class="egg-title">{{eggData.title}}</view>
      <view class="egg-desc">{{eggData.desc}}</view>
      
      <view class="egg-reward-box">
        <text class="reward-label">获得奖励</text>
        <view class="reward-val-row">
          <text class="val-num">+{{eggData.bonus}}</text>
          <text class="val-unit">g 爱意 💧</text>
        </view>
      </view>
      <button class="btn-get-egg" bindtap="closeEggModal">
        <text>开心收下 ❤️</text>
      </button>
    </view>
  </view>

  <food-prep-modal show="{{showFoodPrepModal}}"
                   loveEnergy="{{loveEnergy}}"
                   foodInventory="{{foodInventory}}"
                   bind:cancel="onFoodPrepModalCancel"
                   bind:prepare="onFoodPrepare"
                   bind:success="onFoodPrepSuccess"></food-prep-modal>

</view>