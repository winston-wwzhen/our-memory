<view class="playground-container room-bg">

  <!-- æˆ¿é—´è£…é¥° -->
  <view class="room-decoration">
    <!-- çª—æˆ· -->
    <view class="window-frame">
      <view class="window-scene">
        <text class="weather-icon">{{currentWeather}}</text>
        <text class="time-text">{{currentTime}}</text>
      </view>
    </view>
    <!-- è£…é¥°å…ƒç´  -->
    <view class="decorative-elements">
      <view class="decoration star star1">â­</view>
      <view class="decoration star star2">âœ¨</view>
      <view class="decoration cloud cloud1">â˜ï¸</view>
      <view class="decoration cloud cloud2">â˜ï¸</view>
    </view>
  </view>

  <!-- æ‚¬æµ®çŠ¶æ€å¡ç‰‡ -->
  <view class="floating-status-card {{showStatusDetail ? 'expanded' : ''}}" bindtap="toggleStatusDetail">
    <view class="status-main">
      <view class="pet-avatar">
        <image src="../../images/pet-avatar.png" class="avatar-img" mode="aspectFit"></image>
        <view class="level-badge">{{petInfo.level}}</view>
      </view>
      <view class="pet-info">
        <text class="pet-name">å°èŒå® </text>
        <text class="pet-mood">{{petInfo.moodName}} {{petInfo.moodEmoji}}</text>
      </view>
      <view class="status-actions">
        <text class="expand-icon">{{showStatusDetail ? 'â–²' : 'â–¼'}}</text>
      </view>
    </view>
    <view class="status-detail" wx:if="{{showStatusDetail}}">
      <view class="detail-row">
        <text class="detail-label">ç­‰çº§</text>
        <text class="detail-value">{{petInfo.levelName}}</text>
      </view>
      <view class="exp-progress">
        <view class="exp-bar">
          <view class="exp-fill" style="width: {{petInfo.expProgress}}%"></view>
        </view>
        <text class="exp-text">{{petInfo.exp}}/{{petInfo.nextLevelExp}} EXP</text>
      </view>
      <view class="mood-progress">
        <text class="mood-label">å¿ƒæƒ…å€¼</text>
        <view class="mood-bar">
          <view class="mood-fill" style="width: {{petInfo.mood}}%"></view>
        </view>
        <text class="mood-text">{{petInfo.mood}}/100</text>
      </view>
    </view>
  </view>

  <view class="garden-card glass-effect">
    <view class="card-header">
      <text class="card-title">ğŸ¾ äº’åŠ¨åŒºåŸŸ</text>
      <view class="harvest-badge" wx:if="{{memoryCount > 0}}">
        <text>ğŸ† æ—…è¡Œ: {{memoryCount}}æ¬¡</text>
      </view>
      <view class="water-badge" wx:else>
        <text>ğŸ– ç²®ä»“: {{waterCount}}ä»½</text>
      </view>
    </view>


    <view class="log-bubble" bindtap="toggleLogModal">
      <text class="bubble-icon">ğŸ“</text>
      <text class="bubble-txt">æˆé•¿æ—¥è®°</text>
    </view>

    <!-- ä¼´ä¾£çŠ¶æ€æç¤º -->
    <view class="partner-status-bubble {{partnerStatus ? 'show' : ''}}" wx:if="{{partnerStatus}}">
      <text class="status-icon">ğŸ’•</text>
      <text class="status-text">{{partnerStatus}}</text>
    </view>

    <view class="album-bubble" bindtap="navToAlbum" wx:if="{{memoryCount > 0}}">
      <text class="bubble-icon">ğŸ–¼ï¸</text>
      <text class="bubble-txt">æ—…è¡Œç›¸å†Œ</text>
      <view class="album-count">{{memoryCount}}</view>
    </view>

    <!-- å® ç‰©äº’åŠ¨åŒºåŸŸ -->
    <view class="pet-play-area">
      <!-- åœ°é¢è£…é¥° -->
      <view class="ground-decoration">
        <view class="grass-decoration grass1">ğŸŒ±</view>
        <view class="grass-decoration grass2">ğŸŒ¿</view>
        <view class="grass-decoration grass3">ğŸŒ¾</view>
        <view class="flower-decoration flower1">ğŸŒ¸</view>
        <view class="flower-decoration flower2">ğŸŒ¼</view>
      </view>

      <!-- çŠ¶æ€æ°”æ³¡ -->
      <view class="pet-speech-bubble {{petState}}" wx:if="{{petSpeechText}}">
        <text class="bubble-text">{{petSpeechText}}</text>
        <view class="bubble-tail"></view>
      </view>

      <!-- äº’åŠ¨ç‰¹æ•ˆå±‚ -->
      <view class="effects-layer">
        <!-- çˆ±å¿ƒé£˜åŠ¨ -->
        <view class="hearts-container" wx:if="{{showHearts}}">
          <view class="heart heart1" animation="{{heartAnimation1}}">ğŸ’–</view>
          <view class="heart heart2" animation="{{heartAnimation2}}">ğŸ’</view>
          <view class="heart heart3" animation="{{heartAnimation3}}">ğŸ’–</view>
          <view class="heart heart4" animation="{{heartAnimation4}}">ğŸ’•</view>
        </view>

        <!-- æ˜Ÿæ˜Ÿé—ªçƒ -->
        <view class="sparkles" wx:if="{{showSparkles}}">
          <view class="sparkle sparkle1" animation="{{sparkleAnimation1}}">âœ¨</view>
          <view class="sparkle sparkle2" animation="{{sparkleAnimation2}}">â­</view>
          <view class="sparkle sparkle3" animation="{{sparkleAnimation3}}">âœ¨</view>
          <view class="sparkle sparkle4" animation="{{sparkleAnimation4}}">ğŸŒŸ</view>
        </view>

        <!-- éŸ³ç¬¦ç‰¹æ•ˆ -->
        <view class="music-notes" wx:if="{{showMusicNotes}}">
          <view class="note note1" animation="{{noteAnimation1}}">â™ª</view>
          <view class="note note2" animation="{{noteAnimation2}}">â™«</view>
          <view class="note note3" animation="{{noteAnimation3}}">â™ª</view>
        </view>
      </view>

      <!-- å® ç‰©ä¸»ä½“ -->
      <view class="pet-container" bindtap="onPetTap" bindlongpress="onPetLongPress">
        <!-- å…‰ç¯æ•ˆæœ -->
        <view class="pet-glow {{petMoodLevel}}" wx:if="{{showPetGlow}}"></view>

        <!-- æ—…è¡ŒçŠ¶æ€ -->
        <view class="travel-status" wx:if="{{status === 'TRAVELING'}}">
          <view class="travel-bubble">
            <text class="travel-text">æ—…è¡Œä¸­...</text>
            <view class="travel-progress">
              <view class="progress-ring">
                <view class="progress-ring-circle" style="transform: rotate({{travelProgress}}deg);"></view>
              </view>
              <text class="progress-text">{{travelProgressPercentage}}%</text>
            </view>
          </view>
          <image src="../../images/note.png" class="pet-img traveling" mode="aspectFit"></image>
        </view>

        <!-- å…¶ä»–çŠ¶æ€ -->
        <view class="pet-wrapper" wx:else>
          <!-- å½±å­ -->
          <view class="pet-shadow"></view>
          <image
            src="{{petImages[status] || defaultPetImage}}"
            class="pet-img {{petAnimation}}"
            mode="aspectFit"
            animation="{{petMainAnimation}}"
          ></image>

          <!-- çŠ¶æ€å›¾æ ‡ -->
          <view class="pet-status-icon" wx:if="{{status !== 'IDLE'}}">
            <text>{{statusIcons[status]}}</text>
          </view>

          <!-- å¿ƒæƒ…æŒ‡ç¤ºå™¨ -->
          <view class="mood-indicator {{petMoodLevel}}" wx:if="{{showMoodIndicator}}">
            <text class="mood-icon">{{petMoodEmoji}}</text>
          </view>
        </view>
      </view>

      <!-- äº’åŠ¨æç¤º -->
      <view class="interaction-guide {{guideType}}" wx:if="{{showGuide}}">
        <view class="guide-arrow {{guideDirection}}"></view>
        <text class="guide-text">{{guideText}}</text>
      </view>
    </view>

    <view class="progress-box">
      <view class="progress-bar">
        <view class="progress-inner" style="width: {{progress}};"></view>
      </view>

      <text class="level-text" wx:if="{{status === 'IDLE'}}">
      <block wx:if="{{interactionCount > 0}}">çˆ±å¿ƒæ”¶é›†: {{interactionCount}}/30 Â· ç²®ä»“: {{waterCount}}ä»½</block>
      <block wx:else>å¼€å§‹æ”¶é›†çˆ±å¿ƒï¼Œè®©èŒå® å»æ—…è¡Œå§ï¼Â· ç²®ä»“: {{waterCount}}ä»½</block>
    </text>
      <text class="level-text max-level" wx:elif="{{status === 'READY_TO_TRAVEL'}}">ğŸ’ èƒ½é‡æ»¡å•¦ï¼Œå‡†å¤‡å‡ºé—¨æ—…è¡Œå’¯ï¼</text>
      <text class="level-text" wx:elif="{{status === 'TRAVELING'}}" style="color:#2196f3; font-weight:bold;">âœˆï¸ æ—…è¡Œä¸­ï¼Œé¢„è®¡å½’æ¥: {{travelCountDown}}</text>
      <text class="level-text max-level" wx:else>ğŸ æ—…è¡Œå½’æ¥ï¼Œå¸¦å›çºªå¿µç¤¼ç‰©å•¦ï¼</text>
    </view>

    <button class="btn-harvest" bindtap="onStartTravel" wx:if="{{status === 'READY_TO_TRAVEL'}}">
      <text>ğŸ’ æ”¶æ‹¾è¡Œå›Šå‡ºå‘</text>
    </button>

    <button class="btn-water" disabled="true" style="background:#b0bec5; box-shadow:none;" wx:elif="{{status === 'TRAVELING'}}">
      <text>æ—…è¡Œä¸­...</text>
    </button>

    <button class="btn-harvest" bindtap="onWelcomeHome" wx:elif="{{status === 'READY_TO_HARVEST'}}">
      <text>ğŸ è¿æ¥å›å®¶</text>
    </button>

    <button class="btn-water" bindtap="onFeed" disabled="{{loading}}" wx:else>
      <text>å–‚é£Ÿç½å¤´</text>
    </button>

    <view class="tip-text" wx:if="{{status === 'IDLE'}}">ğŸ“¸ æ¯æ—¥åˆç…§æ‰“å¡ï¼Œèµšå–çˆ±å¿ƒç²® (+10ä»½)</view>
    <view class="tip-text" wx:else>æ¯æ¬¡æ—…è¡Œå½’æ¥ï¼Œéƒ½ä¼šå¸¦å›çè´µçš„æ˜ä¿¡ç‰‡å“¦ ğŸ–¼ï¸</view>
  </view>

  <!-- åŠŸèƒ½å¿«æ·å…¥å£ -->
  <view class="quick-actions">
    <view class="action-card" bindtap="navToFunHub">
      <view class="action-icon">ğŸ¡</view>
      <text class="action-title">æ›´å¤šåŠŸèƒ½</text>
      <text class="action-desc">æ¢ç´¢ç²¾å½©äº’åŠ¨</text>
      <view class="action-arrow">â†’</view>
    </view>
  </view>
  
  <view class="log-modal-mask {{showLogModal ? 'show' : ''}}" bindtap="toggleLogModal">
    <view class="log-modal-container" catchtap="return"> 
      <view class="log-modal-header">
        <text>ğŸ“œ æˆé•¿æ—¥è®°</text>
        <view class="close-icon" bindtap="toggleLogModal">Ã—</view>
      </view>
      <scroll-view scroll-y class="log-scroll-view">
        <view class="empty-log" wx:if="{{logs.length === 0}}">
          <text>æš‚æ— è®°å½•ï¼Œå¿«å»å–‚é£Ÿå°èŒå® å§~</text>
        </view>
        <block wx:else>
          <view class="modal-log-item {{item.type}}" wx:for="{{logs}}" wx:key="index">
            <view class="log-icon">
              <block wx:if="{{item.type === 'water'}}">ğŸ’</block>
              <block wx:elif="{{item.type === 'travel_start'}}">âœˆï¸</block>
              <block wx:elif="{{item.type === 'harvest'}}">ğŸ</block>
              <block wx:else>ğŸ“</block>
            </view>
            <view class="modal-log-content">
              <view class="modal-log-top">
                <text class="modal-log-name {{item.isMine ? 'mine' : 'partner'}}">{{item.nickName}}</text>
                <text class="modal-log-time">{{item.timeAgo}}</text>
              </view>
              <text class="modal-log-desc">{{item.content}}</text>
            </view>
          </view>
        </block>
      </scroll-view>
    </view>
  </view>

  <view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
    <view class="god-rays"></view>
    <view class="confetti-container">
        <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
        <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
        <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
        <view class="confetti c10"></view>
    </view>
    <view class="egg-card bounce-in">
      <view class="card-ribbon">LUCKY TIME</view>
      <view class="icon-stage">
        <view class="halo-ring"></view>
        <text class="egg-icon">{{eggData.icon}}</text>
        <view class="shine-star s-left">âœ¨</view>
        <view class="shine-star s-right">âœ¨</view>
      </view>
      <view class="egg-title">{{eggData.title}}</view>
      <view class="egg-desc">{{eggData.desc}}</view>
      <view class="egg-reward-box">
        <text class="reward-label">è·å¾—å¥–åŠ±</text>
        <view class="reward-val-row">
          <text class="val-num">+{{eggData.bonus}}</text>
          <text class="val-unit">g çˆ±æ„ ğŸ’§</text>
        </view>
      </view>
      <button class="btn-get-egg" bindtap="closeEggModal">
        <text>å¼€å¿ƒæ”¶ä¸‹ â¤ï¸</text>
      </button>
    </view>
  </view>
</view>