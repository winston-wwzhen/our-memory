<view class="playground-container">

  <view class="room-container" style="background-image: url('{{roomBgImage}}')">
    <!-- Pet Character Layer -->
    <view wx:if="{{petState === 'idle'}}" class="pet-container">
      <image src="/images/pet/ready.png"
             class="pet-character {{petAnimation}}"
             bindtap="onPetTap"></image>
    </view>

    <view wx:elif="{{petState === 'eating'}}" class="pet-container">
      <image src="/images/pet/eat.png"
             class="pet-character eating-animation"></image>
    </view>

    <!-- Travel State - Show Note -->
    <view wx:elif="{{petState === 'traveling'}}" class="travel-note-container">
      <image src="/images/pet/note.png" class="travel-note"></image>
      <text class="note-text">{{petName}}å»æ—…è¡Œå•¦~</text>
      <text class="return-time">é¢„è®¡{{returnTimeStr}}è¿”å›</text>
    </view>

    <!-- UI Overlay Layer -->
    <view class="ui-overlay">
      <!-- Top Left: Pet Info -->
      <view class="pet-info-panel">
        <text class="pet-name">{{petName}}</text>
        <view class="mood-container">
          <text class="mood-label">â¤ï¸ å¿ƒæƒ…</text>
          <progress percent="{{moodValue}}"
                    border-radius="10"
                    activeColor="#ff6b6b"
                    backgroundColor="#ffe0e0"
                    class="mood-bar" />
          <text class="mood-value">{{moodValue}}/100</text>
        </view>
      </view>

      <!-- Top Right: Resources -->
      <view class="resource-panel">
        <view class="resource-item">
          <text class="resource-icon">ğŸ’§</text>
          <text class="resource-value">{{loveEnergy}}g</text>
        </view>
      </view>

      <!-- Bottom Right: Action Buttons -->
      <view class="action-buttons">
        <view class="action-btn backpack {{petState !== 'idle' ? 'disabled' : ''}}"
              bindtap="onBackpackTap">
          <text class="btn-icon">ğŸ’</text>
          <text class="btn-text">è¡Œå›Š</text>
        </view>
      </view>

      <!-- Bottom Left: Mail -->
      <view class="mail-button {{hasNewPostcards ? 'with-notification' : ''}}"
            bindtap="onPostcardsTap">
        <text class="mail-icon">ğŸ“®</text>
      </view>
    </view>

    <!-- Status Messages -->
    <view wx:if="{{statusMessage}}" class="status-message">
      <text>{{statusMessage}}</text>
    </view>

    <!-- Heart Particles -->
    <view wx:for="{{heartParticles}}" wx:key="id"
          class="heart-particle"
          style="left: {{item.left}}%; bottom: 20%;">
      â¤ï¸
    </view>
  </view>

  <view class="grid-menu">
    <!-- Food Prep -->
    <view class="grid-item paper-texture" catchtap="onFoodPrep">
      <view class="grid-icon">ğŸ±</view>
      <text class="grid-title">å‡†å¤‡ä¾¿å½“</text>
      <text class="grid-desc">ä¸ºæ—…è¡Œå‡†å¤‡é£Ÿç‰©</text>
    </view>

    <!-- Travel Map -->
    <view class="grid-item paper-texture" bindtap="onTravelMap">
      <view class="grid-icon">ğŸ—ºï¸</view>
      <text class="grid-title">æ—…è¡Œåœ°å›¾</text>
      <text class="grid-desc">é€‰æ‹©ç›®çš„åœ°</text>
    </view>

    <!-- Postcards -->
    <view class="grid-item paper-texture" bindtap="onPostcards">
      <view class="grid-icon">ğŸ’Œ</view>
      <text class="grid-title">æ˜ä¿¡ç‰‡</text>
      <text class="grid-desc">æ—…è¡Œå›å¿†</text>
      <view wx:if="{{hasNewPostcards}}" class="notification-heart">â¤</view>
    </view>

    <!-- Keep existing bottom 3 items -->
    <view class="grid-item paper-texture" bindtap="navToQuiz">
      <view class="grid-icon">ğŸ§©</view>
      <text class="grid-title">é»˜å¥‘å¤§é—¯å…³</text>
      <text class="grid-desc">æŒ‘æˆ˜çµé­‚å¥‘åˆåº¦</text>

      <view class="notification-quiz" wx:if="{{quizHint}}">â“</view>
    </view>

    <view class="grid-item paper-texture" bindtap="navToBoard">
      <view class="grid-icon">ğŸ“Œ</view>
      <text class="grid-title">çˆ±çš„ç•™è¨€æ¿</text>
      <text class="grid-desc">æ—¥å¸¸ç¢ç¢å¿µ</text>

      <view class="notification-pin" wx:if="{{messageHint}}">ğŸ“Œ</view>
    </view>

    <view class="grid-item paper-texture" bindtap="navToCapsule">
      <view class="grid-icon">ğŸ’Š</view>
      <text class="grid-title">æ—¶å…‰èƒ¶å›Š</text>
      <text class="grid-desc">å¯„ç»™æœªæ¥</text>

      <view class="notification-heart" wx:if="{{capsuleRedDot}}">â¤</view>
    </view>
  </view>


  <view class="log-modal-mask {{showLogModal ? 'show' : ''}}" bindtap="toggleLogModal">
    <view class="log-modal-container" catchtap="return">
      <view class="log-modal-header">
        <text>ğŸ“œ äº’åŠ¨æ—¥è®°</text>
        <view class="close-icon" bindtap="toggleLogModal">Ã—</view>
      </view>
      <scroll-view scroll-y class="log-scroll-view">
        <view class="empty-log" wx:if="{{logs.length === 0}}">
          <text>æš‚æ— è®°å½•ï¼Œå¿«å’Œå® ç‰©äº’åŠ¨å§~</text>
        </view>
        <block wx:else>
          <view class="modal-log-item" wx:for="{{logs}}" wx:key="index">
            <image class="modal-log-avatar" src="{{item.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
            <view class="modal-log-content">
              <view class="modal-log-top">
                <text class="modal-log-name {{item.isMine ? 'mine' : 'partner'}}">{{item.nickName}}</text>
                <text class="modal-log-time">{{item.timeAgo}}</text>
              </view>
              <text class="modal-log-desc">{{item.content}}</text>
            </view>
          </view>
        </block>
      </scroll-view>
    </view>
  </view>

<view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
  <view class="god-rays"></view>
  <view class="confetti-container">
    <view class="confetti c1"></view><view class="confetti c2"></view><view class="confetti c3"></view>
    <view class="confetti c4"></view><view class="confetti c5"></view><view class="confetti c6"></view>
    <view class="confetti c7"></view><view class="confetti c8"></view><view class="confetti c9"></view>
    <view class="confetti c10"></view>
  </view>
  <view class="egg-card bounce-in">
    <view class="card-ribbon">LUCKY TIME</view>
    <view class="icon-stage">
      <view class="halo-ring"></view>
      <text class="egg-icon">{{eggData.icon}}</text>
      <view class="shine-star s-left">âœ¨</view>
      <view class="shine-star s-right">âœ¨</view>
    </view>
    <view class="egg-title">{{eggData.title}}</view>
    <view class="egg-desc">{{eggData.desc}}</view>
    <view class="egg-reward-box">
      <text class="reward-label">è·å¾—å¥–åŠ±</text>
      <view class="reward-val-row">
        <text class="val-num">+{{eggData.bonus}}</text>
        <text class="val-unit">g çˆ±æ„ ğŸ’§</text>
      </view>
    </view>
    <button class="btn-get-egg" bindtap="closeEggModal">
      <text>å¼€å¿ƒæ”¶ä¸‹ â¤ï¸</text>
    </button>
  </view>

  </view>

<!-- Food Preparation Modal -->
<food-prep-modal show="{{showFoodPrepModal}}"
                 loveEnergy="{{loveEnergy}}"
                 foodInventory="{{foodInventory}}"
                 bind:cancel="onFoodPrepModalCancel"
                 bind:prepare="onFoodPrepare"
                 bind:success="onFoodPrepSuccess"></food-prep-modal>

</view>