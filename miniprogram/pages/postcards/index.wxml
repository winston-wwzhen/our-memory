<view class="postcards-container">

  <!-- Statistics Summary -->
  <view class="stats-summary paper-texture">
    <view class="stat-item">
      <text class="stat-value">{{totalPostcards}}</text>
      <text class="stat-label">æ€»æ˜ä¿¡ç‰‡</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{totalDestinations}}</text>
      <text class="stat-label">åˆ°è®¿åœ°ç‚¹</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-value">{{specialItems}}</text>
      <text class="stat-label">ç‰¹è‰²æ”¶è—</text>
    </view>
  </view>

  <!-- Loading State -->
  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">æ­£åœ¨åŠ è½½æ˜ä¿¡ç‰‡...</text>
  </view>

  <!-- Postcards List -->
  <scroll-view wx:else scroll-y class="postcards-scroll">
    <view wx:if="{{postcards.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ’Œ</text>
      <text class="empty-text">è¿˜æ²¡æœ‰æ”¶åˆ°æ˜ä¿¡ç‰‡</text>
      <text class="empty-desc">è®©å® ç‰©å»æ—…è¡Œï¼Œæ”¶é›†ç¾å¥½å›å¿†å§ï¼</text>
      <button class="start-travel-btn" bindtap="goToTravelMap">
        <text>ğŸ—ºï¸ å¼€å§‹æ—…è¡Œ</text>
      </button>
    </view>

    <block wx:else>
      <!-- Timeline View -->
      <view class="timeline-view">
        <view wx:for="{{postcards}}" wx:key="id" class="timeline-item">
          <!-- Time Node -->
          <view class="time-node">
            <view class="dot"></view>
            <view class="line"></view>
          </view>

          <!-- Postcard Card -->
          <view class="postcard-card paper-texture" bindtap="onPostcardTap" data-postcard="{{item}}">
            <!-- Postcard Image -->
            <image class="postcard-image" src="{{item.destination.image}}" mode="aspectFill"></image>

            <!-- Postcard Content -->
            <view class="postcard-content">
              <view class="postcard-header">
                <text class="destination-name">{{item.destination.name}}</text>
                <text class="travel-date">{{item.travel_date_formatted}}</text>
              </view>

              <text class="postcard-message">{{item.message}}</text>

              <!-- Rewards Section -->
              <view wx:if="{{item.rewards && item.rewards.length > 0}}" class="rewards-section">
                <text class="rewards-title">è·å¾—</text>
                <view class="rewards-list">
                  <view wx:for="{{item.rewards}}" wx:key="index" wx:for-item="reward" class="reward-item">
                    <text class="reward-icon">{{reward.icon}}</text>
                    <text class="reward-text">{{reward.name}} x{{reward.count}}</text>
                  </view>
                </view>
              </view>

              <!-- Special Items -->
              <view wx:if="{{item.specialty_item}}" class="specialty-item">
                <text class="specialty-icon">â­</text>
                <text class="specialty-name">{{item.specialty_item}}</text>
              </view>
            </view>

          </view>
        </view>
      </view>
    </block>
  </scroll-view>

  <!-- Postcard Detail Modal -->
  <view class="modal-mask {{showDetailModal ? 'show' : ''}}" bindtap="closeDetailModal">
    <view class="detail-modal paper-texture" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ—…è¡Œå›å¿†</text>
        <view class="close-btn" bindtap="closeDetailModal">Ã—</view>
      </view>

      <view wx:if="{{selectedPostcard}}" class="modal-content">
        <image class="modal-postcard-image" src="{{selectedPostcard.destination.image}}" mode="aspectFill"></image>

        <view class="postcard-detail">
          <text class="detail-destination">{{selectedPostcard.destination.name}}</text>
          <text class="detail-date">{{selectedPostcard.travel_date_formatted}}</text>
          <text class="detail-message">{{selectedPostcard.message}}</text>

          <view wx:if="{{selectedPostcard.rewards && selectedPostcard.rewards.length > 0}}" class="detail-section">
            <text class="detail-section-title">è·å¾—å¥–åŠ±</text>
            <view class="rewards-grid">
              <view wx:for="{{selectedPostcard.rewards}}" wx:key="index" wx:for-item="reward" class="reward-card">
                <text class="reward-icon">{{reward.icon}}</text>
                <text class="reward-name">{{reward.name}}</text>
                <text class="reward-count">x{{reward.count}}</text>
              </view>
            </view>
          </view>

          <view wx:if="{{selectedPostcard.specialty_item}}" class="detail-section">
            <text class="detail-section-title">ç‰¹è‰²æ”¶è—</text>
            <view class="specialty-showcase">
              <text class="specialty-icon-large">â­</text>
              <text class="specialty-name-large">{{selectedPostcard.specialty_item}}</text>
            </view>
          </view>
        </view>

        <view class="modal-actions">
          <button class="modal-btn share-btn" bindtap="onSharePostcard" open-type="share">
            <text>ğŸ“¤ åˆ†äº«å›å¿†</text>
          </button>
          <button class="modal-btn save-btn" bindtap="onSavePostcard">
            <text>ğŸ’¾ ä¿å­˜å›¾ç‰‡</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- Share Actions -->
  <action-sheet hidden="{{!showShareActions}}" bindchange="onShareActionChange">
    <action-sheet-item bindtap="onShareToWechat">
      <text>åˆ†äº«ç»™å¾®ä¿¡å¥½å‹</text>
    </action-sheet-item>
    <action-sheet-item bindtap="onShareToMoments">
      <text>åˆ†äº«åˆ°æœ‹å‹åœˆ</text>
    </action-sheet-item>
    <action-sheet-cancel>å–æ¶ˆ</action-sheet-cancel>
  </action-sheet>
</view>