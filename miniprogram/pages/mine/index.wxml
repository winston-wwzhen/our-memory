<view class="mine-container">
  
  <view class="user-card">
    
    <button 
      class="avatar-wrapper" 
      open-type="chooseAvatar" 
      bind:chooseavatar="onChooseAvatar"
    >
      <image 
        class="avatar-img" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="edit-hint" wx:if="{{!userData.avatarUrl}}">ğŸ“·</view>
    </button>

    <view class="nickname-box">
      <input 
        type="nickname" 
        class="nickname-input" 
        placeholder="ç‚¹å‡»è¾“å…¥æ˜µç§°" 
        value="{{userData.nickName}}" 
        bind:change="onInputNickname"
      />
      <view class="edit-icon">âœ</view>
    </view>
    
    <view class="status-badge {{userData.partner_id ? 'connected' : 'single'}}">
      <text wx:if="{{userData.partner_id}}">â¤ï¸ å·²è¿æ¥</text>
      <text wx:else>ğŸ’” å•èº«æ¨¡å¼</text>
    </view>

    <button 
      class="btn-save" 
      bindtap="saveProfile" 
      size="mini"
      wx:if="{{needSave}}"
    >ä¿å­˜èµ„æ–™</button>

  </view>

  <view class="action-card" wx:if="{{!userData.partner_id}}">
    <view class="section-title">å»ºç«‹è¿æ¥ / Handshake</view>
    
    <view class="key-box">
      <text class="label">æˆ‘çš„é€šä¿¡å¯†é’¥ (My Key):</text>
      
      <!-- å¯†é’¥æ˜¾ç¤ºåŒº -->
      <view class="key-display">
        <text class="key-text">{{userData._openid || 'Loading...'}}</text>
      </view>

      <!-- æ“ä½œæŒ‰é’®ç»„ -->
      <view class="key-actions">
        <button 
          class="btn-mini btn-copy" 
          bindtap="copyMyKey"
        >ğŸ“„ å¤åˆ¶</button>
        
        <button 
          class="btn-mini btn-share" 
          open-type="share"
        >ğŸ“¤ å‘é€ç»™ TA</button>
      </view>
      
      <text class="hint">å¯¹æ–¹ç‚¹å‡»åˆ†äº«å¡ç‰‡å¯è‡ªåŠ¨å¡«å…¥</text>
    </view>

    <view class="divider"></view>

    <view class="input-box">
      <text class="label">å¯¹æ–¹å¯†é’¥ (Target Key):</text>
      <input 
        class="key-input" 
        placeholder="ç²˜è´´ TA çš„å¯†é’¥..." 
        bindinput="onInputKey"
      />
      <button class="btn-connect" bindtap="bindPartner">æ‰§è¡Œè¿æ¥</button>
    </view>
  </view>

  <view class="action-card" wx:else>
    <view class="love-info">
      <text>Current Protocol: CP-IP v1.0</text>
      <text>Latency: 0ms (In Heart)</text>
      <text style="margin-top: 20rpx; color: #ff6b81;">Linked with [{{partnerShortID}}]</text>
    </view>
    
    <view class="danger-zone">
      <button 
        class="btn-unbind" 
        bindtap="onUnbind" 
      >âš ï¸ Terminate Connection</button>
      <text class="danger-hint">*æ­¤æ“ä½œä»…é™ç®¡ç†å‘˜/ä»˜è´¹ç”¨æˆ·</text>
    </view>
  </view>

</view>