<view class="page-container">
  
  <view class="bg-layer">
    <view class="circle-deco c1"></view>
    <view class="circle-deco c2"></view>
  </view>

  <view class="profile-card bounce-in">
    <view class="card-top-bar">
      <view class="vip-badge {{vipStatus.isVip ? 'is-vip' : ''}}" bindtap="showVipInfo">
        <text class="icon">👑</text>
        <text>{{vipStatus.isVip ? '尊贵VIP' : '普通会员'}}</text>
      </view>
      <view class="id-tag" bindtap="copyMyKey">
        <text>ID: {{userData._openid}}</text>
        <text class="copy-icon">❐</text>
      </view>
    </view>

    <view class="avatars-area">
      
      <button class="avatar-btn me" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
        <image class="avatar-img" src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="camera-badge">📷</view>
      </button>

      <view class="connect-status">
        <block wx:if="{{userData.partner_id}}">
          <view class="heart-beat">❤️</view>
          <view class="days-box">
            <text class="days-num">{{daysCount}}</text>
            <text class="days-txt">Days</text>
          </view>
        </block>
        <block wx:else>
          <view class="disconnect-line"></view>
          <text class="disconnect-txt">等待连接</text>
        </block>
      </view>

      <view class="avatar-right-wrap">
        <block wx:if="{{userData.partner_id}}">
          <image class="avatar-img partner" src="{{partnerData.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="name-tag">{{partnerData.nickName || 'TA'}}</view>
        </block>
        <block wx:else>
          <button class="invite-btn-circle" bindtap="showInviteModal">
            <text class="plus-icon">+</text>
          </button>
          <view class="name-tag">邀请TA</view>
        </block>
      </view>
    </view>

    <view class="info-edit-area">
      <view class="nickname-row">
        <input type="nickname" class="nickname-input" value="{{userData.nickName}}" placeholder="点击设置昵称" bind:change="onInputNickname" />
        <text class="edit-icon">✎</text>
      </view>
      
      <block wx:if="{{userData.partner_id}}">
        <picker mode="date" value="{{anniversary}}" bindchange="onDateChange">
          <view class="date-pill">
            <text>🗓️ 恋爱起始日: {{anniversary || '未设置'}}</text>
          </view>
        </picker>
      </block>
      <block wx:else>
        <text class="single-hint" bindtap="showInviteModal">点击右侧“+”号，邀请另一半开启纪念册</text>
      </block>
    </view>
  </view>

  <view class="reward-entry slide-up" wx:if="{{pendingRewards}}" bindtap="onClaimRewards">
    <view class="entry-left">
      <view class="gift-icon-box">🎁</view>
      <view class="entry-text">
        <text class="entry-title">邀请奖励已到账</text>
        <text class="entry-desc">含 {{pendingRewards.water}}g 爱意 + {{pendingRewards.quota}}次 额度</text>
      </view>
    </view>
    <view class="entry-btn">立即领取</view>
  </view>

  <view class="menu-group slide-up-delay">
    
    <button class="menu-item highlight" open-type="share" data-type="referral">
      <view class="mi-left">
        <view class="mi-icon yellow">🤝</view>
        <view class="mi-content">
          <text class="mi-title">邀请好友得福利</text>
          <text class="mi-desc">送好友VIP，你得永久额度</text>
        </view>
      </view>
      <view class="mi-tag">去邀请</view>
    </button>

    <view class="menu-item" bindtap="{{userData.partner_id ? 'onUnbind' : 'showInviteModal'}}">
      <view class="mi-left">
        <view class="mi-icon pink">🔗</view>
        <view class="mi-content">
          <text class="mi-title">{{userData.partner_id ? '解除关联' : '绑定另一半'}}</text>
          <text class="mi-desc">{{userData.partner_id ? '断开连接 (慎用)' : '解锁双人功能'}}</text>
        </view>
      </view>
      <text class="mi-arrow">></text>
    </view>

    <button class="menu-item" open-type="contact">
      <view class="mi-left">
        <view class="mi-icon blue">🎧</view>
        <view class="mi-content">
          <text class="mi-title">联系客服</text>
          <text class="mi-desc">反馈问题或建议</text>
        </view>
      </view>
      <text class="mi-arrow">></text>
    </button>

    <view class="menu-item" wx:if="{{needSave}}" bindtap="saveProfile">
      <view class="mi-left">
        <view class="mi-icon green">💾</view>
        <view class="mi-content">
          <text class="mi-title">保存资料</text>
          <text class="mi-desc">同步头像与昵称</text>
        </view>
      </view>
      <view class="dot-red"></view>
    </view>

  </view>

  <view class="footer-copyright">Designed for Love v1.0.0</view>

  <include src="./components/modals.wxml" /> <view class="oath-modal-mask" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="oath-card bounce-in" wx:if="{{modalType === 'invite'}}" catchtap="true">
        <view class="oath-decoration-top">🕊️</view>
        <view class="oath-title">愿得一人心</view>
        <view class="oath-subtitle">邀请 TA 开启共同回忆</view>
        <view class="oath-warning">
          <text class="warning-desc">相遇不易，开启后请用心经营你们的回忆。</text>
        </view>
        <button class="btn-oath-confirm" open-type="share">🌹 发送邀请</button>
    </view>
    
    <view class="oath-card bounce-in unbind-theme" wx:if="{{modalType === 'unbind'}}" catchtap="true">
        <view class="oath-decoration-top">🍂</view>
        <view class="oath-title">遗憾的决定</view>
        <view class="oath-warning unbind-style">
          <text class="warning-title">⚠️ 高能预警</text>
          <text class="warning-desc">解绑后双方VIP立即失效，且7天内无法再次绑定。</text>
        </view>
        <button class="btn-oath-confirm danger" bindtap="confirmUnbind">
            {{!canUnbind ? '冷静 ' + unbindCount + 's' : '💔 确认解绑'}}
        </button>
        <view class="oath-cancel" bindtap="hideModal">我再想想</view>
    </view>
  </view>

  <view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
     <view class="egg-card bounce-in">
        <view class="card-ribbon">LUCKY TIME</view>
        <view class="icon-stage"><text class="egg-icon">{{eggData.icon}}</text></view>
        <view class="egg-title">{{eggData.title}}</view>
        <view class="egg-desc">{{eggData.desc}}</view>
        <view class="egg-reward-box">
            <text class="val-num">+{{eggData.bonus}}</text> <text class="val-unit">爱意</text>
        </view>
        <button class="btn-get-egg" bindtap="closeEggModal">开心收下</button>
     </view>
  </view>
</view>