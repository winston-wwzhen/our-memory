<view class="mine-container">
  
  <view class="profile-card">
    <view class="pin-decoration"></view> <button 
      class="avatar-wrapper" 
      open-type="chooseAvatar" 
      bind:chooseavatar="onChooseAvatar"
    >
      <image 
        class="avatar-img" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="edit-badge" wx:if="{{!userData.avatarUrl}}">点击设置</view>
    </button>

    <view class="info-area">
      <input 
        type="nickname" 
        class="nickname-input" 
        placeholder="请填写昵称" 
        placeholder-class="placeholder-style"
        value="{{userData.nickName}}" 
        bind:change="onInputNickname"
      />
      
      <view class="save-hint" bindtap="saveProfile" wx:if="{{needSave}}">
        <text>点击保存修改</text>
      </view>
    </view>

    <view class="status-stamp {{userData.partner_id ? 'stamp-connected' : 'stamp-single'}}">
      {{userData.partner_id ? '已 关 联' : '单 人 篇'}}
    </view>
  </view>

  <view class="envelope-card" wx:if="{{!userData.partner_id}}">
    <view class="envelope-header">
      <text class="envelope-title">邀请另一半</text>
      <text class="envelope-sub">共同书写我们的纪念册</text>
    </view>

    <view class="step-box">
      <text class="step-label">① 我的专属编号</text>
      <view class="code-ticket" bindtap="copyMyKey">
        <text class="ticket-num">{{userData._openid || '生成中...'}}</text>
        <text class="ticket-action">复制</text>
      </view>
      <button class="btn-share" open-type="share">发送给 TA</button>
    </view>

    <view class="dashed-line"></view>

    <view class="step-box">
      <text class="step-label">② 填入 TA 的编号</text>
      <view class="input-paper">
        <input 
          class="hand-input" 
          placeholder="在此粘贴 TA 的编号..." 
          bindinput="onInputKey"
          value="{{inputPartnerCode}}"
        />
      </view>
      <button class="btn-bind" bindtap="bindPartner">确认关联</button>
    </view>
  </view>

  <view class="connected-card" wx:else>
    
    <view class="cp-avatars">
      <image 
        class="cp-avatar mine" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      
      <view class="cp-link-heart">❤</view>
      
      <image 
        class="cp-avatar partner" 
        src="{{partnerData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
    </view>

    <text class="connected-text">与 {{partnerData.nickName || 'TA'}} 共同记录中</text>
    <text class="connected-sub">美好的回忆正在发生...</text>

    <view class="unbind-area" bindtap="onUnbind">
      <text>解除关联</text>
    </view>
  </view>

  <view class="footer">
    <text>Our Memory · 我们的纪念册</text>
  </view>

</view>