<view class="page-container">
  
  <view class="bg-layer">
    <view class="circle-deco c1"></view>
    <view class="circle-deco c2"></view>
  </view>

  <view class="profile-card bounce-in">
    <view class="card-top-bar">
      <view class="vip-badge {{vipStatus.isVip ? 'is-vip' : ''}}" bindtap="showVipInfo">
        <text class="icon">ğŸ‘‘</text>
        <text>{{vipStatus.isVip ? 'å°Šè´µVIP' : 'æ™®é€šä¼šå‘˜'}}</text>
      </view>
      <view class="id-tag" bindtap="copyMyKey">
        <text>ID: {{userData._openid}}</text>
        <text class="copy-icon">â</text>
      </view>
    </view>

    <view class="interaction-area">
      
      <view class="user-column">
        <button class="avatar-btn me" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
          <image class="avatar-img" src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
          <view class="camera-badge">ğŸ“·</view>
        </button>
        <view class="name-edit-box">
          <input type="nickname" class="name-input" value="{{userData.nickName}}" placeholder="ç‚¹å‡»è®¾ç½®" bind:change="onInputNickname" />
          <text class="edit-pen">âœ</text>
        </view>
      </view>

      <view class="center-column">
        <block wx:if="{{userData.partner_id}}">
          <picker mode="date" value="{{anniversary}}" bindchange="onDateChange" class="center-picker">
            <view class="heart-box">
              <text class="heart-beat">â¤ï¸</text>
            </view>
            <view class="days-row">
              <text class="days-num">{{daysCount}}</text>
              <text class="days-unit">Days</text>
            </view>
            <view class="since-date">
              <text>Since {{anniversary || 'è®¾ç½®æ—¥æœŸ'}}</text>
            </view>
          </picker>
        </block>
        <block wx:else>
          <view class="disconnect-line"></view>
          <text class="disconnect-txt">ç­‰å¾…è¿æ¥</text>
        </block>
      </view>

      <view class="user-column">
        <block wx:if="{{userData.partner_id}}">
          <view class="avatar-wrap">
            <image class="avatar-img partner" src="{{partnerData.avatarUrl || '../../images/default-avatar.png'}}" mode="aspectFill"></image>
          </view>
          <view class="partner-name">{{partnerData.nickName || 'TA'}}</view>
        </block>
        <block wx:else>
          <button class="invite-btn-circle" bindtap="showInviteModal">
            <text class="plus-icon">+</text>
          </button>
          <view class="partner-name hint">é‚€è¯·TA</view>
        </block>
      </view>

    </view>
  </view>

  <view class="reward-entry slide-up" wx:if="{{pendingRewards}}" bindtap="onClaimRewards">
    <view class="entry-left">
      <view class="gift-icon-box">ğŸ</view>
      <view class="entry-text">
        <text class="entry-title">é‚€è¯·å¥–åŠ±å·²åˆ°è´¦</text>
        <text class="entry-desc">å« {{pendingRewards.water}}g çˆ±æ„ + {{pendingRewards.quota}}æ¬¡ é¢åº¦</text>
      </view>
    </view>
    <view class="entry-btn">ç«‹å³é¢†å–</view>
  </view>

  <view class="menu-group slide-up-delay">
    <button class="menu-item highlight" open-type="share" data-type="referral">
      <view class="mi-left">
        <view class="mi-icon yellow">ğŸ¤</view>
        <view class="mi-content">
          <text class="mi-title">é‚€è¯·å¥½å‹å¾—ç¦åˆ©</text>
          <text class="mi-desc">é€å¥½å‹VIPï¼Œä½ å¾—æ°¸ä¹…é¢åº¦</text>
        </view>
      </view>
      <view class="mi-tag">å»é‚€è¯·</view>
    </button>

    <view class="menu-item" bindtap="{{userData.partner_id ? 'onUnbind' : 'showInviteModal'}}">
      <view class="mi-left">
        <view class="mi-icon pink">ğŸ”—</view>
        <view class="mi-content">
          <text class="mi-title">{{userData.partner_id ? 'è§£é™¤å…³è”' : 'ç»‘å®šå¦ä¸€åŠ'}}</text>
          <text class="mi-desc">{{userData.partner_id ? 'æ–­å¼€è¿æ¥ (æ…ç”¨)' : 'è§£é”åŒäººåŠŸèƒ½'}}</text>
        </view>
      </view>
      <text class="mi-arrow">></text>
    </view>

    <button class="menu-item" open-type="contact">
      <view class="mi-left">
        <view class="mi-icon blue">ğŸ§</view>
        <view class="mi-content">
          <text class="mi-title">è”ç³»å®¢æœ</text>
          <text class="mi-desc">åé¦ˆé—®é¢˜æˆ–å»ºè®®</text>
        </view>
      </view>
      <text class="mi-arrow">></text>
    </button>
    
    </view>

  <view class="footer-copyright">Designed for Love v1.0.0</view>

  <include src="./components/modals.wxml" /> 
  
  <view class="oath-modal-mask" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="oath-card bounce-in" wx:if="{{modalType === 'invite'}}" catchtap="true">
        <view class="oath-decoration-top">ğŸ•Šï¸</view>
        <view class="oath-title">æ„¿å¾—ä¸€äººå¿ƒ</view>
        <view class="oath-subtitle">é‚€è¯· TA å¼€å¯å…±åŒå›å¿†</view>
        <view class="oath-warning">
          <text class="warning-desc">ç›¸é‡ä¸æ˜“ï¼Œå¼€å¯åè¯·ç”¨å¿ƒç»è¥ä½ ä»¬çš„å›å¿†ã€‚</text>
        </view>
        <button class="btn-oath-confirm" open-type="share">ğŸŒ¹ å‘é€é‚€è¯·</button>
    </view>
    
    <view class="oath-card bounce-in unbind-theme" wx:if="{{modalType === 'unbind'}}" catchtap="true">
        <view class="oath-decoration-top">ğŸ‚</view>
        <view class="oath-title">é—æ†¾çš„å†³å®š</view>
        <view class="oath-warning unbind-style">
          <text class="warning-title">âš ï¸ é«˜èƒ½é¢„è­¦</text>
          <text class="warning-desc">è§£ç»‘ååŒæ–¹VIPç«‹å³å¤±æ•ˆï¼Œä¸”7å¤©å†…æ— æ³•å†æ¬¡ç»‘å®šã€‚</text>
        </view>
        <button class="btn-oath-confirm danger" bindtap="confirmUnbind">
            {{!canUnbind ? 'å†·é™ ' + unbindCount + 's' : 'ğŸ’” ç¡®è®¤è§£ç»‘'}}
        </button>
        <view class="oath-cancel" bindtap="hideModal">æˆ‘å†æƒ³æƒ³</view>
    </view>
  </view>

  <view class="egg-modal-mask" wx:if="{{showEggModal}}" catchtouchmove="true">
     <view class="egg-card bounce-in">
        <view class="card-ribbon">LUCKY TIME</view>
        <view class="icon-stage"><text class="egg-icon">{{eggData.icon}}</text></view>
        <view class="egg-title">{{eggData.title}}</view>
        <view class="egg-desc">{{eggData.desc}}</view>
        <view class="egg-reward-box">
           <text class="val-num">+{{eggData.bonus}}</text> <text class="val-unit">çˆ±æ„</text>
        </view>
        <button class="btn-get-egg" bindtap="closeEggModal">å¼€å¿ƒæ”¶ä¸‹</button>
     </view>
  </view>
</view>