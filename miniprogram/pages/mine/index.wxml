<view class="mine-container">
  
  <block wx:if="{{userData.partner_id}}">
    <view class="timer-card paper-texture">
      <view class="timer-header">
        <text class="timer-title">我们已经相爱</text>
        <picker mode="date" value="{{anniversary}}" bindchange="onDateChange">
          <view class="timer-setting">
            <text wx:if="{{anniversary}}">起始日: {{anniversary}}</text>
            <text wx:else>⚙️ 设置纪念日</text>
          </view>
        </picker>
      </view>
      
      <view class="timer-content">
        <text class="timer-number">{{daysCount}}</text>
        <text class="timer-unit">天</text>
      </view>
      <view class="timer-footer">Love is a long journey.</view>
    </view>
  </block>

  <block wx:else>
    <view class="welcome-card paper-texture">
      <view class="welcome-header">
        <text class="welcome-title">欢迎使用我们的纪念册！</text>
        <text class="welcome-subtitle">Welcome, Single Chapter Creator</text>
      </view>
      <view class="welcome-content">
        <text>🎉 你当前处于单人模式，所有回忆将为你个人珍藏。</text>
        <text>👫 想要解锁共同回忆？请在下方关联你的另一半！</text>
      </view>
    </view>
  </block>

  <view class="user-card paper-texture">
    <button 
      class="avatar-wrapper" 
      open-type="chooseAvatar" 
      bind:chooseavatar="onChooseAvatar"
    >
      <image 
        class="avatar-img" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="edit-badge">📷</view>
    </button>

    <view class="nickname-row">
      <view class="nickname-box">
        <input 
          type="nickname" 
          class="nickname-input" 
          placeholder="点击设置昵称" 
          placeholder-class="nickname-placeholder"
          value="{{userData.nickName}}" 
          bind:change="onInputNickname"
        />
        <text class="edit-icon">✎</text>
      </view>
    </view>
    
    <view class="status-tag {{userData.partner_id ? 'connected' : 'waiting'}}">
      <text wx:if="{{userData.partner_id}}">❤️ 恋爱纪念册</text>
      <text wx:else>✨ 开启单人篇章</text>
    </view>

    <button 
      class="btn-save" 
      bindtap="saveProfile" 
      size="mini"
      wx:if="{{needSave}}"
    >保存资料</button>
  </view>

  <view class="action-card paper-texture" wx:if="{{!userData.partner_id}}">
    <view class="card-header">
      <text class="card-title">邀请另一半</text>
      <text class="card-subtitle">Invite your love</text>
    </view>
    
    <view class="code-section">
      <text class="label">我的专属编号</text>
      <view class="code-display" bindtap="copyMyKey">
        <text class="code-text">{{userData._openid || '生成中...'}}</text>
        <view class="copy-tag">复制</view>
      </view>
      <button class="btn-share-pill" open-type="share">
        📤 发送给 TA
      </button>
    </view>

    <view class="divider-line"></view>

    <view class="input-section">
      <text class="label">填入 TA 的编号</text>
      <view class="input-wrapper">
        <input 
          class="code-input" 
          placeholder="在此粘贴 TA 的编号..." 
          bindinput="onInputKey"
          value="{{inputPartnerCode}}"
        />
      </view>
      <button class="btn-connect-pill" bindtap="bindPartner">确认关联</button>
    </view>
  </view>

  <view class="action-card paper-texture connected-state" wx:else>
    
    <view class="bg-decoration">✨</view>

    <view class="cp-avatars-box">
      <image 
        class="cp-avatar mine" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      
      <view class="heart-beat">❤</view>
      
      <image 
        class="cp-avatar partner" 
        src="{{partnerData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
    </view>

    <view class="love-content">
      <text class="love-title">我们正在共同记录</text>
      
      <text class="love-partner" wx:if="{{partnerData.nickName}}">与 {{partnerData.nickName}}</text>
      <text class="love-partner" wx:else>与 TA ({{partnerShortID}})</text>
      
      <text class="love-desc-sub">未来的每一天，都值得被珍藏。</text>
    </view>
    
    <view class="footer-actions">
      <view class="unbind-link" bindtap="onUnbind">解除关联</view>
    </view>
  </view>

  <view class="footer-info">
    <text>Designed for Love</text>
  </view>

</view>