<view class="mine-container">
  
  <view class="user-card paper-texture">
    <button 
      class="avatar-wrapper" 
      open-type="chooseAvatar" 
      bind:chooseavatar="onChooseAvatar"
    >
      <image 
        class="avatar-img" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      <view class="edit-hint" wx:if="{{!userData.avatarUrl}}">点我变好看 ✨</view>
    </button>

    <view class="nickname-box">
      <input 
        type="nickname" 
        class="nickname-input" 
        placeholder="写下你的名字" 
        placeholder-class="nickname-placeholder"
        value="{{userData.nickName}}" 
        bind:change="onInputNickname"
      />
    </view>
    
    <view class="status-tag {{userData.partner_id ? 'connected' : 'waiting'}}">
      <text wx:if="{{userData.partner_id}}">❤️ 恋爱纪念册</text>
      <text wx:else>✨ 等待爱的连接</text>
    </view>

    <button 
      class="btn-save" 
      bindtap="saveProfile" 
      size="mini"
      wx:if="{{needSave}}"
    >保存我的名片</button>
  </view>

  <view class="action-card paper-texture" wx:if="{{!userData.partner_id}}">
    <view class="card-header">
      <text class="card-title">💌 呼叫另一半</text>
      <text class="card-subtitle">Connect with Love</text>
    </view>
    
    <view class="code-section">
      <text class="label">我的恋爱暗号</text>
      <view class="code-display" bindtap="copyMyKey">
        <text class="code-text">{{userData._openid || '生成中...'}}</text>
        <view class="copy-tag">复制</view>
      </view>
      <button class="btn-share-pill" open-type="share">
        🚀 发送邀请函
      </button>
    </view>

    <view class="divider-line"></view>

    <view class="input-section">
      <text class="label">输入 TA 的暗号</text>
      <view class="input-wrapper">
        <input 
          class="code-input" 
          placeholder="在此粘贴 TA 的暗号..." 
          bindinput="onInputKey"
          value="{{inputPartnerCode}}"
        />
      </view>
      <button class="btn-connect-pill" bindtap="bindPartner">🔒 锁定彼此</button>
    </view>
  </view>

  <view class="action-card paper-texture connected-state" wx:else>
    
    <view class="bg-decoration">✨</view>

    <view class="cp-avatars-box">
      <image 
        class="cp-avatar mine" 
        src="{{userData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
      
      <view class="heart-beat">❤</view>
      
      <image 
        class="cp-avatar partner" 
        src="{{partnerData.avatarUrl || '../../images/default-avatar.png'}}" 
        mode="aspectFill"
      ></image>
    </view>

    <view class="love-content">
      <text class="love-title">👩‍❤️‍💋‍👨 甜蜜连线中</text>
      
      <text class="love-partner" wx:if="{{partnerData.nickName}}">与 {{partnerData.nickName}} 一起书写回忆</text>
      <text class="love-partner" wx:else>与 TA ({{partnerShortID}}) 一起书写回忆</text>
      
      <text class="love-desc-sub">往后余生，请多指教。</text>
    </view>
    
    <view class="footer-actions">
      <view class="unbind-link" bindtap="onUnbind">💔 暂时断开</view>
    </view>
  </view>

  <view class="footer-info">
    <text>Made with ❤️ for Us</text>
  </view>

</view>