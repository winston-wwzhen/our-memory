<!--miniprogram/pages/album/index.wxml-->
<view class="album-container">
  <view class="header">
    <text class="title">ğŸ–¼ï¸ æ—…è¡Œç›¸å†Œ</text>
    <text class="subtitle">è®°å½•ç¾å¥½æ—¶å…‰</text>
  </view>

  <view class="stats">
    <view class="stat-item">
      <text class="stat-num">{{totalMemories}}</text>
      <text class="stat-label">æœ¬å›å¿†å½•</text>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <text class="stat-num">{{totalPostcards}}</text>
      <text class="stat-label">å¼ æ˜ä¿¡ç‰‡</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading && memories.length === 0}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">æ­£åœ¨åŠ è½½ç›¸å†Œ...</text>
  </view>

  <view class="album-grid" wx:else>
    <view class="empty-album" wx:if="{{memories.length === 0 && !loading}}">
      <image src="../../images/empty-box.png" mode="aspectFit" class="empty-icon"></image>
      <text class="empty-text">è¿˜æ²¡æœ‰æ˜ä¿¡ç‰‡</text>
      <text class="empty-desc">å¸¦èŒå® å»æ—…è¡Œæ”¶é›†çºªå¿µå§ï¼</text>
    </view>

    <block wx:else>
      <view class="memory-card" wx:for="{{memories}}" wx:key="_id" catchtap="viewMemory" data-index="{{index}}" id="memory-{{index}}">
        <view class="card-border">
          <!-- åŠ è½½çŠ¶æ€ -->
          <view class="loading-placeholder" wx:if="{{!item.loaded && !item.loadError}}">
            <view class="loading-animation"></view>
          </view>
          <image
            src="{{item.url}}"
            mode="aspectFill"
            class="postcard-img {{item.loaded ? 'loaded' : ''}}"
            lazy-load
            binderror="onImageError"
            bindload="onImageLoad"
            data-index="{{index}}"
          ></image>
          <view class="memory-info">
            <text class="memory-name">{{item.name}}</text>
            <text class="memory-date">{{item.dateStr}}</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
  <view class="preview-modal {{showPreview ? 'show' : ''}}" bindtap="closePreview">
    <view class="preview-container" catchtap="stopPropagation">
      <image src="{{currentMemory.url}}" mode="aspectFit" class="preview-img"></image>
      <view class="preview-info">
        <text class="preview-title">{{currentMemory.name}}</text>
        <text class="preview-date">{{currentMemory.fullDate}}</text>
      </view>
      <button class="btn-share" bindtap="shareMemory" open-type="share">
        <text class="share-icon">ğŸ“¤</text>
        <text>åˆ†äº«çºªå¿µ</text>
      </button>
    </view>
  </view>
</view>