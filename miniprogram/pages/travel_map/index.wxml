<view class="travel-map-container">
  <view class="dashboard-card paper-texture">
    <view class="dashboard-row">
      <view class="status-item">
        <view class="status-icon-bg energy-bg">
          <text class="status-icon">⚡</text>
        </view>
        <view class="status-info">
          <text class="status-label">精力值</text>
          <text class="status-value">{{petEnergy}}/100</text>
        </view>
      </view>

      <view class="status-item">
        <view class="status-icon-bg mood-bg">
          <text class="status-icon">❤️</text>
        </view>
        <view class="status-info">
          <text class="status-label">心情</text>
          <text class="status-value">{{moodValue}}/100</text>
        </view>
      </view>
    </view>
    <view class="dashboard-divider"></view>
    <view class="inventory-row">
      <view class="inventory-label">
        <text>🎒 便当库存</text>
      </view>
      <view class="food-badges">
        <view class="food-badge">
          <text>🍙 饭团 x{{foodCount.rice_ball || 0}}</text>
        </view>
        <view class="food-badge luxury">
          <text>🍱 御膳 x{{foodCount.luxury_bento || 0}}</text>
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{loading}}" class="loading-container">
    <text class="loading-text">正在规划旅行路线...</text>
  </view>

  <scroll-view wx:else scroll-y class="destinations-scroll">
    <view wx:if="{{destinations.length === 0}}" class="empty-state">
      <text class="empty-icon">🗺️</text>
      <text class="empty-text">暂无可前往的目的地</text>
      <text class="empty-desc">多去探索，解锁更多旅行地点吧！</text>
    </view>

    <block wx:else>
      <view class="destinations-section" wx:if="{{availableDestinations.length > 0}}">
        <view class="section-header">
          <text class="section-icon">📍</text>
          <text class="section-title">准备出发</text>
        </view>
        
        <view wx:for="{{availableDestinations}}" wx:key="id" class="destination-card paper-texture ripple-effect" bindtap="onSelectDestination" data-destination="{{item}}">
          
          <view class="image-wrapper">
            <image class="destination-image" src="{{item.image}}" mode="aspectFill"></image>
            
            <view class="visited-seal" wx:if="{{item.visited}}">
              <text>已打卡</text>
            </view>
          </view>
          
          <view class="destination-content">
            <view class="card-top">
              <text class="destination-name">{{item.name}}</text>
              <view class="tag-time">
                <text>⏱️ {{item.duration}}分钟</text>
              </view>
            </view>

            <text class="destination-desc">{{item.description}}</text>

            <view class="rewards-box">
              <text class="reward-label">🎁 掉落：</text>
              <text class="reward-text">{{item.rewardsStr || '未知宝藏'}}</text>
            </view>

            <view class="card-footer">
               <view class="requirements">
                <text class="req-tag" wx:if="{{item.food_required === 'any'}}">🍱 任意便当 <text style="font-weight:900; color:#ff6b81;">x {{item.foodCost}}</text></text>
                <text class="req-tag" wx:elif="{{item.food_required === 'deluxe_meal'}}">🍱 豪华御膳 <text style="font-weight:900; color:#ff6b81;">x {{item.foodCost}}</text></text>
                <text class="req-tag" wx:else>🍙 饭团便当 <text style="font-weight:900; color:#ff6b81;">x {{item.foodCost}}</text></text>
              </view>
              <view class="action-btn-area">
                <text class="go-btn-text">GO 🚀</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
    <view style="height: 40rpx;"></view>
  </scroll-view>

  <view class="modal-mask {{showTravelModal ? 'show' : ''}}" bindtap="closeTravelModal">
    <view class="travel-modal paper-texture" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">确认行程</text>
        <view class="close-btn" bindtap="closeTravelModal">×</view>
      </view>

      <view wx:if="{{selectedDestination}}" class="modal-content">
        <image class="modal-destination-image" src="{{selectedDestination.image}}" mode="aspectFill"></image>
        <text class="modal-destination-name">{{selectedDestination.name}}</text>
        
        <view class="modal-info-grid">
           <view class="info-cell">
             <text class="cell-label">预计耗时</text>
             <text class="cell-value">{{selectedDestination.duration}} 分钟</text>
           </view>
           <view class="info-cell">
             <text class="cell-label">消耗精力</text>
             <text class="cell-value">-{{TRAVEL_ENERGY_COST}}</text>
           </view>
        </view>

        <view class="food-selection-area">
          <text class="area-title">选择便当</text>
          <view wx:if="{{availableFoods.length > 0}}" class="food-radio-group">
            <radio-group bindchange="onFoodChange">
              <label wx:for="{{availableFoods}}" wx:key="type" class="food-option-item {{item.type === selectedFood ? 'selected' : ''}}">
                <view class="food-option-left">
                  <radio value="{{item.type}}" checked="{{item.type === selectedFood}}"/>
                  <view class="food-details">
                    <text class="food-name">{{item.name}}</text>
                    <text class="food-bonus" style="color:#ff6b81; font-weight:bold;">消耗: {{item.cost}}</text>
                  </view>
                </view>
                <text class="food-count-badge">库存: {{item.count}}</text>
              </label>
            </radio-group>
          </view>
          
          <view wx:else class="no-food-warning">
            <text>⚠️ 背包里没有符合要求的便当</text>
          </view>
        </view>
      </view>

      <view class="modal-actions">
        <button class="modal-btn cancel-btn" bindtap="closeTravelModal">再想想</button>
        <button wx:if="{{canTravel}}" class="modal-btn confirm-btn" bindtap="confirmTravel">出发</button>
        <button wx:else class="modal-btn confirm-btn disabled" disabled>无法出发</button>
      </view>
    </view>
  </view>
</view>