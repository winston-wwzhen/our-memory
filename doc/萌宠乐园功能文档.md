# 萌宠乐园功能文档

## 1. 功能概述

萌宠乐园是微信小程序"OurMemory"中的核心互动功能，旨在为情侣提供一个虚拟宠物养成系统。通过共同照料宠物、制作食物、发送旅行等互动，增进情侣间的感情交流。

### 1.1 核心特色

- **双人共同照料**：宠物由情侣双方共同拥有和照料
- **实时互动系统**：抚摸、喂食等多种互动方式
- **旅行探索系统**：宠物可以旅行带回纪念品和奖励
- **精致UI设计**：采用玻璃态设计风格，视觉效果出色
- **完整养成体系**：包含心情值、体力值等属性管理

## 2. 功能架构

### 2.1 页面布局

页面采用三段式布局设计：

```
┌─────────────────────────────────────┐  ← 萌宠花园舞台 (64%)
│          状态卡片    爱意值胶囊       │
│                                     │
│            [宠物形象]               │
│                                     │
│                                     │
├───────────── GARDEN TIME ───────────┤  ← 玫瑰分割线
│  🗺️  💌  📜               🍽️  🎒  │  ← 功能花圃 (36%)
│  地图  信箱  日记            喂食  行囊 │
└─────────────────────────────────────┘
```

### 2.2 组件说明

#### 2.2.1 顶部区域组件

- **状态卡片**（左上角）
  - 显示宠物名称：小可爱
  - 心情值进度条（0-100）
  - 体力值进度条（0-100）
  - 帮助按钮（点击显示属性说明）

- **爱意值胶囊**（右上角）
  - 显示当前爱意能量
  - 用于制作食物的消耗

#### 2.2.2 中央舞台区域

- **宠物形象展示**
  - 空闲状态：显示默认姿态
  - 进食状态：播放进食动画
  - 旅行状态：显示旅行提示

- **背景效果**
  - 根据时间切换白天/夜晚背景
  - 心跳粒子效果（互动时触发）

#### 2.2.3 功能花圃区域

- **侧边导航组**
  - 🗺️ 地图：旅行功能选择
  - 💌 信箱：查看旅行带回的明信片
  - 📜 日记：查看互动历史记录

- **操作按钮组**
  - 🍽️ 喂食：打开喂食菜单
  - 🎒 行囊：打开食物制作界面

## 3. 游戏机制详解

### 3.1 宠物属性系统

#### 3.1.1 心情值（mood_value）

影响宠物的情绪状态和旅行奖励：

| 数值范围 | 状态 | 表情 | 效果 |
|---------|------|------|------|
| 80-100 | 超开心 | 😊 | 旅行玫瑰掉落率+20% |
| 60-79 | 很开心 | 🙂 | 正常状态 |
| 40-59 | 还不错 | 😐 | 正常状态 |
| 20-39 | 有点低落 | 😔 | 无特殊效果 |
| 0-19 | 很沮丧 | 😢 | 无特殊效果 |

**变化规则**：
- 抚摸互动：+2
- 喂食饭团便当：+10
- 喂食豪华御膳：+20

#### 3.1.2 体力值（energy_level）

决定宠物是否可以进行旅行：

| 数值范围 | 状态 | 表情 | 效果 |
|---------|------|------|------|
| 80-100 | 精力充沛 | 💪 | 最佳状态 |
| 60-79 | 活力满满 | 🙂 | 正常状态 |
| 40-59 | 还不错 | 😐 | 正常状态 |
| 30-39 | 有点累了 | 😴 | 旅行消耗增加 |
| 0-29 | 疲惫不堪 | 😫 | 无法旅行 |

**变化规则**：
- 抚摸互动：-1
- 喂食饭团便当：+20
- 喂食豪华御膳：+40
- 旅行一次：-30

### 3.2 互动系统

#### 3.2.1 抚摸互动

**触发方式**：点击宠物形象

**效果**：
- 心情值 +2
- 体力值 -1
- 触发爱心粒子动画
- 记录互动日志

**限制**：
- 仅在空闲状态（idle）可互动
- 互动有0.5秒冷却时间

#### 3.2.2 喂食系统

**食物类型**：

1. **饭团便当**
   - 制作成本：10g爱意
   - 效果：体力+20，心情+10
   - 制作时间：即时

2. **豪华御膳**
   - 制作成本：50g爱意
   - 效果：体力+40，心情+20
   - 制作时间：即时

**喂食流程**：
1. 点击喂食按钮打开食物选择框
2. 选择要喂食的食物
3. 确认后立即生效
4. 宠物播放3秒进食动画

### 3.3 旅行系统

#### 3.3.1 旅行条件

- 体力值 ≥ 30
- 宠物处于空闲状态
- 选择旅行地点

#### 3.3.2 旅行机制

**旅行时间**：根据目的地随机生成（5-30秒）

**旅行消耗**：固定消耗30点体力

**奖励计算**：

1. **基础奖励**
   - 固定获得30g爱意

2. **玫瑰奖励**
   - 保底进度机制：每350进度获得1朵玫瑰
   - 情绪加成：心情值≥80时，玫瑰掉落率+20%
   - 进度计算：基础进度 + 随机浮动

3. **纪念品奖励**
   - 根据旅行地点获得对应特产
   - 纪念品用于解锁后续功能

#### 3.3.3 自动结算

- 旅行结束自动计算并发放奖励
- 宠物状态自动恢复为空闲
- 生成明信片记录（信箱功能查看）

## 4. 数据结构

### 4.1 宠物数据模型

```javascript
{
  _id: "pet_id",                    // 宠物唯一标识
  owners: ["user1_id", "user2_id"], // 主人列表（情侣双方）
  name: "小可爱",                   // 宠物名称
  mood_value: 60,                   // 心情值 (0-100)
  energy_level: 80,                 // 体力值 (0-100)
  state: "idle",                    // 状态：idle/eating/traveling
  current_action: null,             // 当前动作详情
  travel_count: 0,                  // 旅行次数
  unlocked_locations: ["park"],     // 已解锁地点
  food_inventory: {                 // 食物库存
    rice_ball: 0,                   // 饭团便当数量
    luxury_bento: 0                 // 豪华御膳数量
  },
  guaranteed_progress: 0,           // 保底进度
  last_interaction: Date,           // 最后互动时间
  created_at: Date,                 // 创建时间
  updated_at: Date                  // 更新时间
}
```

### 4.2 用户数据模型

```javascript
{
  _id: "user_id",
  // ... 其他用户信息
  love_currency: 100,               // 爱意值
  roses: 5,                         // 玫瑰数量
  couple_id: "couple_id",           // 情侣关系ID
  // ... 其他字段
}
```

### 4.3 互动日志模型

```javascript
{
  _id: "log_id",
  user_id: "user_id",               // 操作用户ID
  couple_id: "couple_id",           // 情侣ID
  action: "pet",                    // 动作类型
  details: {
    type: "feed",                   // 具体类型：feed/pet/travel
    food: "rice_ball",              // 食物类型（喂食时）
    mood_change: +10,               // 心情变化
    energy_change: +20,             // 体力变化
    location: "park"                // 旅行地点（旅行时）
  },
  timestamp: Date,                  // 操作时间
  created_at: Date                  // 创建时间
}
```

## 5. 云函数API文档

### 5.1 获取宠物状态

**接口名称**：`get_pet_status`

**请求参数**：
```javascript
{
  user_id: "用户ID"
}
```

**返回数据**：
```javascript
{
  code: 0,
  message: "success",
  data: {
    pet: PetData,                   // 宠物完整数据
    user_love_currency: 100,        // 用户爱意值
    interaction_logs: [...]         // 最近互动记录
  }
}
```

### 5.2 宠物互动

**接口名称**：`interact_with_pet`

**请求参数**：
```javascript
{
  user_id: "用户ID",
  action: "pet"                     // 动作类型
}
```

**返回数据**：
```javascript
{
  code: 0,
  message: "互动成功",
  data: {
    mood_value: 62,                 // 更新后的心情值
    energy_level: 79,               // 更新后的体力值
    log_id: "log_id"                // 日志记录ID
  }
}
```

### 5.3 制作食物

**接口名称**：`prepare_food`

**请求参数**：
```javascript
{
  user_id: "用户ID",
  food_type: "rice_ball"            // 食物类型
}
```

**返回数据**：
```javascript
{
  code: 0,
  message: "制作成功",
  data: {
    love_currency: 90,              // 更新后的爱意值
    food_inventory: {
      rice_ball: 1,                 // 更新后的食物库存
      luxury_bento: 0
    }
  }
}
```

### 5.4 喂食宠物

**接口名称**：`feed_pet`

**请求参数**：
```javascript
{
  user_id: "用户ID",
  food_type: "rice_ball"            // 食物类型
}
```

**返回数据**：
```javascript
{
  code: 0,
  message: "喂食成功",
  data: {
    mood_value: 70,                 // 更新后的心情值
    energy_level: 100,              // 更新后的体力值
    food_inventory: {
      rice_ball: 0,                 // 更新后的食物库存
      luxury_bento: 0
    }
  }
}
```

### 5.5 发送旅行

**接口名称**：`send_pet_travel`

**请求参数**：
```javascript
{
  user_id: "用户ID",
  location: "park"                  // 旅行地点
}
```

**返回数据**：
```javascript
{
  code: 0,
  message: "旅行开始",
  data: {
    travel_duration: 15,            // 旅行时长（秒）
    completion_time: Date,          // 完成时间
    pet_state: "traveling"          // 宠物状态
  }
}
```

### 5.6 收取旅行奖励

**接口名称**：`collect_travel_rewards`

**请求参数**：
```javascript
{
  user_id: "用户ID",
  pet_id: "pet_id"
}
```

**返回数据**：
```javascript
{
  code: 0,
  message: "收取成功",
  data: {
    love_earned: 30,                // 获得的爱意
    roses_earned: 1,                // 获得的玫瑰数
    souvenirs: ["特产品"],          // 获得的纪念品
    new_mood: 70,                   // 更新后的心情值
    new_energy: 50                  // 更新后的体力值
  }
}
```

## 6. UI交互细节

### 6.1 动画效果

1. **心跳粒子动画**
   - 触发条件：点击宠物时
   - 动画时长：1秒
   - 效果：3个爱心从宠物位置向上飘散

2. **进食动画**
   - 触发条件：喂食后
   - 动画时长：3秒
   - 效果：宠物切换到进食图片

3. **按钮点击效果**
   - 所有按钮都有0.2s的缩放动画
   - 提供触觉反馈

### 6.2 模态框交互

1. **喂食模态框**
   - 显示食物列表和库存
   - 点击食物项立即执行喂食
   - 自动关闭并播放动画

2. **制作食物模态框**
   - 显示食物类型和成本
   - 制作成功有成功提示
   - 更新库存显示

3. **互动日记模态框**
   - 分页显示最近10条记录
   - 包含用户头像和时间戳
   - 支持滚动查看历史

### 6.3 帮助系统

点击状态卡片上的帮助按钮，显示属性说明：

- **心情值**：影响宠物的快乐程度和旅行收益
- **体力值**：决定宠物是否有精力去旅行探索
- **爱意能量**：用于制作美味的食物
- **玫瑰花**：爱情的见证，可用于解锁特殊功能

## 7. 开发注意事项

### 7.1 性能优化

- 使用定时器合理轮询旅行状态（建议3秒一次）
- 图片资源使用CDN加速
- 本地缓存宠物状态，减少网络请求

### 7.2 错误处理

- 网络异常时显示友好提示
- 操作失败时恢复之前的状态
- 记录错误日志便于排查

### 7.3 扩展性设计

- 预留了更多旅行地点的扩展空间
- 食物系统可以轻松添加新种类
- 纪念品系统为后续功能做铺垫

## 8. 版本历史

- **v1.0.0**（2025-12）
  - 基础宠物养成功能
  - 旅行系统
  - 食物制作系统
  - 互动日志记录

## 9. 待实现功能

1. **地图功能**：显示更多旅行地点
2. **信箱功能**：查看旅行明信片详情
3. **宠物装扮**：为宠物购买和穿戴装饰
4. **成就系统**：完成特定目标获得奖励
5. **排行榜**：与其他情侣比较养成进度

---

*文档最后更新时间：2025-12-14*