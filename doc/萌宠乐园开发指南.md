# 萌宠乐园开发指南

## 快速上手

### 文件结构

```
miniprogram/pages/playground/
├── index.js          # 页面逻辑
├── index.json        # 页面配置
├── index.wxml        # 页面结构
└── index.wxss        # 页面样式

cloudfunctions/pet/
├── index.js          # 云函数入口
├── package.json      # 依赖配置
└── schemas/          # 数据模型定义

images/pet/
├── pet.png          # 宠物默认形象
├── eat.png          # 进食动画
├── home.jpg         # 白天背景
└── back.png         # 夜晚背景
```

### 关键方法调用流程

#### 1. 页面初始化
```javascript
// index.js - onLoad
onLoad() {
  this.getPetStatus();    // 获取宠物状态
  this.startTimer();      // 启动定时器
}
```

#### 2. 宠物互动
```javascript
// 点击宠物 -> interactWithPet()
interactWithPet() {
  // 调用云函数 interact_with_pet
  // 更新本地状态
  // 播放动画效果
}
```

#### 3. 喂食流程
```javascript
// 点击喂食 -> showFeedModal() -> feedPet()
feedPet(foodType) {
  // 调用云函数 feed_pet
  // 更新食物库存
  // 播放进食动画
}
```

#### 4. 旅行系统
```javascript
// 选择地点 -> sendTravel() -> 定时检查
sendTravel(location) {
  // 调用云函数 send_pet_travel
  // 开始倒计时
  // 定时检查是否完成
}
```

### 常用状态值

```javascript
// 宠物状态
PET_STATES = {
  IDLE: 'idle',           // 空闲
  EATING: 'eating',       // 进食中
  TRAVELING: 'traveling'  // 旅行中
}

// 食物类型
FOOD_TYPES = {
  RICE_BALL: 'rice_ball',     // 饭团便当
  LUXURY_BENTO: 'luxury_bento' // 豪华御膳
}

// 旅行地点
LOCATIONS = {
  PARK: 'park',           // 公园
  BEACH: 'beach',         // 海滩
  MOUNTAIN: 'mountain'    // 山地（待解锁）
}
```

### 调试技巧

1. **查看实时状态**
   ```javascript
   console.log('当前宠物状态:', this.data.pet);
   ```

2. **模拟旅行完成**
   ```javascript
   // 修改数据库中 pet.completion_time 为过去时间
   ```

3. **重置宠物状态**
   ```javascript
   // 修改数据库中 pet.state 为 'idle'
   ```

### 性能优化建议

1. 使用 `wx.nextTick` 优化UI更新
2. 定时器及时清理，避免内存泄漏
3. 图片资源使用压缩格式

### 常见问题

**Q: 为什么点击宠物没有反应？**
A: 检查宠物是否处于空闲状态（state === 'idle'）

**Q: 旅行奖励没有自动到账？**
A: 检查定时器是否正常运行，确认 completion_time 是否到达

**Q: 食物制作失败？**
A: 检查用户爱意值是否足够

---

*更新时间：2025-12-14*